/*! tw2overflow.min.js@1.0.5 | Licence MIT */
!function(a,b){define("Lockr",function(a,b){"use strict";return b.prefix="",b._getPrefixedKey=function(a,b){return b=b||{},b.noPrefix?a:this.prefix+a},b.set=function(a,b,c){var d=this._getPrefixedKey(a,c);try{localStorage.setItem(d,JSON.stringify({data:b}))}catch(a){}},b.get=function(a,b,c){var d,e=this._getPrefixedKey(a,c);try{d=JSON.parse(localStorage.getItem(e))}catch(a){d=localStorage[e]?{data:localStorage.getItem(e)}:null}return null===d?b:"object"==typeof d&&void 0!==d.data?d.data:b},b}(a,{}))}(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(){this.translate=d(this.translate,this),this.data={values:{},contexts:[]},this.globalContext={}}return a.prototype.translate=function(a,b,c,d,e){var f,g,h,i;return null==e&&(e=this.globalContext),h=function(a){var b;return"function"===(b=typeof a)||"object"===b&&!!a},h(b)?(f=null,i=null,g=b,e=c||this.globalContext):"number"==typeof b?(f=null,i=b,g=c,e=d||this.globalContext):(f=b,"number"==typeof c?(i=c,g=d,e=e):(i=null,g=c,e=d||this.globalContext)),h(a)?(h(a.i18n)&&(a=a.i18n),this.translateHash(a,e)):this.translateText(a,i,g,e,f)},a.prototype.add=function(a){var b,c,d,e,f,g,h,i;if(null!=a.values){g=a.values;for(c in g)d=g[c],this.data.values[c]=d}if(null!=a.contexts){for(h=a.contexts,i=[],e=0,f=h.length;e<f;e++)b=h[e],i.push(this.data.contexts.push(b));return i}},a.prototype.setContext=function(a,b){return this.globalContext[a]=b},a.prototype.clearContext=function(a){return this.lobalContext[a]=null},a.prototype.reset=function(){return this.data={values:{},contexts:[]},this.globalContext={}},a.prototype.resetData=function(){return this.data={values:{},contexts:[]}},a.prototype.resetContext=function(){return this.globalContext={}},a.prototype.translateHash=function(a,b){var c,d;for(c in a)"string"==typeof(d=a[c])&&(a[c]=this.translateText(d,null,null,b));return a},a.prototype.translateText=function(a,b,c,d,e){var f,g;return null==d&&(d=this.globalContext),null==this.data?this.useOriginalText(e||a,b,c):(f=this.getContextData(this.data,d),null!=f&&(g=this.findTranslation(a,b,c,f.values,e)),null==g&&(g=this.findTranslation(a,b,c,this.data.values,e)),null==g?this.useOriginalText(e||a,b,c):g)},a.prototype.findTranslation=function(a,b,c,d){var e,f,g,h,i;if(null==(g=d[a]))return null;if(null==b){if("string"==typeof g)return this.applyFormatting(g,b,c)}else if(g instanceof Array||g.length)for(h=0,i=g.length;h<i;h++)if(f=g[h],(b>=f[0]||null===f[0])&&(b<=f[1]||null===f[1]))return e=this.applyFormatting(f[2].replace("-%n",String(-b)),b,c),this.applyFormatting(e.replace("%n",String(b)),b,c);return null},a.prototype.getContextData=function(a,b){var c,d,e,f,g,h,i,j;if(null==a.contexts)return null;for(i=a.contexts,g=0,h=i.length;g<h;g++){c=i[g],d=!0,j=c.matches;for(e in j)f=j[e],d=d&&f===b[e];if(d)return c}return null},a.prototype.useOriginalText=function(a,b,c){return null==b?this.applyFormatting(a,b,c):this.applyFormatting(a.replace("%n",String(b)),b,c)},a.prototype.applyFormatting=function(a,b,c){var d,e;for(d in c)e=new RegExp("%{"+d+"}","g"),a=a.replace(e,c[d]);return a},a}(),c=new a,b=c.translate,b.translator=c,b.create=function(c){var d;return d=new a,null!=c&&d.add(c),d.translate.create=b.create,d.translate},define("i18n",function(){return b})}.call(this),function(a){define("ejs",function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){var d;if("/"==a.charAt(0))d=c.resolveInclude(a.replace(/^\/*/,""),b.root||"/",!0);else{if(!b.filename)throw new Error("`include` use relative path requires the 'filename' option.");d=c.resolveInclude(a,b.filename)}return d}function e(a,b){var d,e=a.filename,f=arguments.length>1;if(a.cache){if(!e)throw new Error("cache option requires a filename");if(d=c.cache.get(e))return d;f||(b=g(e).toString().replace(v,""))}else if(!f){if(!e)throw new Error("Internal EJS error: no file name or template provided");b=g(e).toString().replace(v,"")}return d=c.compile(b,a),a.cache&&c.cache.set(e,d),d}function f(a,b,c){var d;try{d=e(a)(b)}catch(a){return c(a)}return c(null,d)}function g(a){return c.fileLoader(a)}function h(a,b){var c=o.shallowCopy({},b);return c.filename=d(a,c),e(c)}function i(a,b){var c,e,f=o.shallowCopy({},b);c=d(a,f),e=g(c).toString().replace(v,""),f.filename=c;var h=new l(e,f);return h.generateSource(),{source:h.source,filename:c,template:e}}function j(a,b,c,d,e){var f=b.split("\n"),g=Math.max(d-3,0),h=Math.min(f.length,d+3),i=e(c),j=f.slice(g,h).map(function(a,b){var c=b+g+1;return(c==d?" >> ":"    ")+c+"| "+a}).join("\n");throw a.path=i,a.message=(i||"ejs")+":"+d+"\n"+j+"\n\n"+a.message,a}function k(a){return a.replace(/;(\s*$)/,"$1")}function l(a,b){b=b||{};var d={};this.templateText=a,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",this.dependencies=[],d.client=b.client||!1,d.escapeFunction=b.escape||o.escapeXML,d.compileDebug=!1!==b.compileDebug,d.debug=!!b.debug,d.filename=b.filename,d.delimiter=b.delimiter||c.delimiter||r,d.strict=b.strict||!1,d.context=b.context,d.cache=b.cache||!1,d.rmWhitespace=b.rmWhitespace,d.root=b.root,d.localsName=b.localsName||c.localsName||s,d.strict?d._with=!1:d._with=void 0===b._with||b._with,this.opts=d,this.regex=this.createRegex()}var m=a("fs"),n=a("path"),o=a("./utils"),p=!1,q=a("../package.json").version,r="%",s="locals",t=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename"],u=t.concat("cache"),v=/^\uFEFF/;c.cache=o.cache,c.fileLoader=m.readFileSync,c.localsName=s,c.resolveInclude=function(a,b,c){var d=n.dirname,e=n.extname,f=n.resolve,g=f(c?b:d(b),a);return e(a)||(g+=".ejs"),g},c.compile=function(a,b){var c;return b&&b.scope&&(p||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),p=!0),b.context||(b.context=b.scope),delete b.scope),c=new l(a,b),c.compile()},c.render=function(a,b,c){var d=b||{},f=c||{};return 2==arguments.length&&o.shallowCopyFromList(f,d,t),e(f,a)(d)},c.renderFile=function(){var a,b=arguments[0],c=arguments[arguments.length-1],d={filename:b};return arguments.length>2?(a=arguments[1],3===arguments.length?a.settings&&a.settings["view options"]?o.shallowCopyFromList(d,a.settings["view options"],u):o.shallowCopyFromList(d,a,u):o.shallowCopy(d,arguments[2]),d.filename=b):a={},f(d,a,c)},c.clearCache=function(){c.cache.reset()},l.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},l.prototype={createRegex:function(){var a="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",b=o.escapeRegExpChars(this.opts.delimiter);return a=a.replace(/%/g,b),new RegExp(a)},compile:function(){var a,b,c=this.opts,d="",e="",f=c.escapeFunction;this.source||(this.generateSource(),d+="  var __output = [], __append = __output.push.bind(__output);\n",!1!==c._with&&(d+="  with ("+c.localsName+" || {}) {\n",e+="  }\n"),e+='  return __output.join("");\n',this.source=d+this.source+e),a=c.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+(c.filename?JSON.stringify(c.filename):"undefined")+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,c.debug&&console.log(a),c.client&&(a="escapeFn = escapeFn || "+f.toString()+";\n"+a,c.compileDebug&&(a="rethrow = rethrow || "+j.toString()+";\n"+a)),c.strict&&(a='"use strict";\n'+a);try{b=new Function(c.localsName+", escapeFn, include, rethrow",a)}catch(a){throw a instanceof SyntaxError&&(c.filename&&(a.message+=" in "+c.filename),a.message+=" while compiling ejs\n\n",a.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",a.message+="https://github.com/RyanZim/EJS-Lint"),a}if(c.client)return b.dependencies=this.dependencies,b;var g=function(a){var d=function(b,d){var e=o.shallowCopy({},a);return d&&(e=o.shallowCopy(e,d)),h(b,c)(e)};return b.apply(c.context,[a||{},f,d,j])};return g.dependencies=this.dependencies,g},generateSource:function(){this.opts.rmWhitespace&&(this.templateText=this.templateText.replace(/\r/g,"").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var a=this,b=this.parseTemplateText(),d=this.opts.delimiter;b&&b.length&&b.forEach(function(e,f){var g,h,j,k,l,m;if(0===e.indexOf("<"+d)&&0!==e.indexOf("<"+d+d)&&(h=b[f+2])!=d+">"&&h!="-"+d+">"&&h!="_"+d+">")throw new Error('Could not find matching close tag for "'+e+'".');if((j=e.match(/^\s*include\s+(\S+)/))&&(g=b[f-1])&&(g=="<"+d||g=="<"+d+"-"||g=="<"+d+"_"))return k=o.shallowCopy({},a.opts),l=i(j[1],k),m=a.opts.compileDebug?"    ; (function(){\n      var __line = 1\n      , __lines = "+JSON.stringify(l.template)+"\n      , __filename = "+JSON.stringify(l.filename)+";\n      try {\n"+l.source+"      } catch (e) {\n        rethrow(e, __lines, __filename, __line);\n      }\n    ; }).call(this)\n":"    ; (function(){\n"+l.source+"    ; }).call(this)\n",a.source+=m,void a.dependencies.push(c.resolveInclude(j[1],k.filename));a.scanLine(e)})},parseTemplateText:function(){for(var a,b=this.templateText,c=this.regex,d=c.exec(b),e=[];d;)a=d.index,0!==a&&(e.push(b.substring(0,a)),b=b.slice(a)),e.push(d[0]),b=b.slice(d[0].length),d=c.exec(b);return b&&e.push(b),e},scanLine:function(a){function b(){c.truncate?(a=a.replace(/^(?:\r\n|\r|\n)/,""),c.truncate=!1):c.opts.rmWhitespace&&(a=a.replace(/^\n/,"")),a&&(a=a.replace(/\\/g,"\\\\"),a=a.replace(/\n/g,"\\n"),a=a.replace(/\r/g,"\\r"),a=a.replace(/"/g,'\\"'),c.source+='    ; __append("'+a+'")\n')}var c=this,d=this.opts.delimiter,e=0;switch(e=a.split("\n").length-1,a){case"<"+d:case"<"+d+"_":this.mode=l.modes.EVAL;break;case"<"+d+"=":this.mode=l.modes.ESCAPED;break;case"<"+d+"-":this.mode=l.modes.RAW;break;case"<"+d+"#":this.mode=l.modes.COMMENT;break;case"<"+d+d:this.mode=l.modes.LITERAL,this.source+='    ; __append("'+a.replace("<"+d+d,"<"+d)+'")\n';break;case d+d+">":this.mode=l.modes.LITERAL,this.source+='    ; __append("'+a.replace(d+d+">",d+">")+'")\n';break;case d+">":case"-"+d+">":case"_"+d+">":this.mode==l.modes.LITERAL&&b(),this.mode=null,this.truncate=0===a.indexOf("-")||0===a.indexOf("_");break;default:if(this.mode){switch(this.mode){case l.modes.EVAL:case l.modes.ESCAPED:case l.modes.RAW:a.lastIndexOf("//")>a.lastIndexOf("\n")&&(a+="\n")}switch(this.mode){case l.modes.EVAL:this.source+="    ; "+a+"\n";break;case l.modes.ESCAPED:this.source+="    ; __append(escapeFn("+k(a)+"))\n";break;case l.modes.RAW:this.source+="    ; __append("+k(a)+")\n";break;case l.modes.COMMENT:break;case l.modes.LITERAL:b()}}else b()}c.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},c.escapeXML=o.escapeXML,c.__express=c.renderFile,a.extensions&&(a.extensions[".ejs"]=function(a,b){var d=b||a.filename,e={filename:d,client:!0},f=g(d).toString(),h=c.compile(f,e);a._compile("module.exports = "+h.toString()+";",d)}),c.VERSION=q,c.name="ejs","undefined"!=typeof window&&(window.ejs=c)},{"../package.json":6,"./utils":2,fs:3,path:4}],2:[function(a,b,c){"use strict";function d(a){return f[a]||a}var e=/[|\\{}()[\]^$+*?.]/g;c.escapeRegExpChars=function(a){return a?String(a).replace(e,"\\$&"):""};var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},g=/[&<>\'"]/g;c.escapeXML=function(a){return void 0==a?"":String(a).replace(g,d)},c.escapeXML.toString=function(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'},c.shallowCopy=function(a,b){b=b||{};for(var c in b)a[c]=b[c];return a},c.shallowCopyFromList=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];void 0!==b[e]&&(a[e]=b[e])}return a},c.cache={_data:{},set:function(a,b){this._data[a]=b},get:function(a){return this._data[a]},reset:function(){this._data={}}}},{}],3:[function(a,b,c){},{}],4:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;i<g;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return b<0&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:5}],5:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],6:[function(a,b,c){b.exports={name:"ejs",description:"Embedded JavaScript templates",keywords:["template","engine","ejs"],version:"2.5.6",author:"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)",contributors:["Timothy Gu <timothygu99@gmail.com> (https://timothygu.github.io)"],license:"Apache-2.0",main:"./lib/ejs.js",repository:{type:"git",url:"git://github.com/mde/ejs.git"},bugs:"https://github.com/mde/ejs/issues",homepage:"https://github.com/mde/ejs",dependencies:{},devDependencies:{browserify:"^13.0.1",eslint:"^3.0.0","git-directory-deploy":"^1.5.1",istanbul:"~0.4.3",jake:"^8.0.0",jsdoc:"^3.4.0","lru-cache":"^4.0.1",mocha:"^3.0.2","uglify-js":"^2.6.2"},engines:{node:">=0.10.0"},scripts:{test:"mocha",lint:'eslint "**/*.js" Jakefile',coverage:"istanbul cover node_modules/mocha/bin/_mocha",doc:"jake doc",devdoc:"jake doc[dev]"}}},{}]},{},[1])(1)}())}(),function(a,b){var c=angular.element(document).scope(),d=injector.get("modelDataService"),e=injector.get("socketService"),f=injector.get("routeProvider"),g=injector.get("eventTypeProvider"),h=injector.get("windowDisplayService"),i=injector.get("windowManagerService"),j=injector.get("hotkeys"),k=injector.get("armyService"),l=injector.get("villageService"),m=injector.get("mapService"),n=injector.get("$filter");define("two/eventQueue",function(){var a={},b={};return b.bind=function(b,c){a.hasOwnProperty(b)||(a[b]=[]),a[b].push(c)},b.trigger=function(b,c){a.hasOwnProperty(b)&&a[b].forEach(function(a){a.apply(this,c)})},b}),define("two/utils",["helper/time"],function(a){var b={};return b.randomSeconds=function(a){a=parseInt(a,10);var b=a+a/2,c=a-a/2;return Math.round(Math.random()*(b-c)+c)},b.time2seconds=function(a){return a=a.split(":"),a[0]=60*parseInt(a[0],10)*60,a[1]=60*parseInt(a[1],10),a[2]=parseInt(a[2],10),a.reduce(function(a,b){return a+b})},b.emitNotif=function(a,b){var d="success"===a?g.MESSAGE_SUCCESS:g.MESSAGE_ERROR;c.$broadcast(d,{message:b})},b.genVillageLabel=function(a){return a.name+" ("+a.x+"|"+a.y+")"},b.isValidCoords=function(a){return/\s*\d{2,3}\|\d{2,3}\s*/.test(a)},b.isValidDateTime=function(a){return/^\s*([01][0-9]|2[0-3]):[0-5]\d:[0-5]\d(:\d{1,3})? (0[1-9]|[12][0-9]|3[0-1])\/(0[1-9]|1[0-2])\/\d{4}\s*$/.test(a)},b.fixDate=function(a){var b=a.split(" "),c=b[0],d=b[1].split("/");return c+" "+d[1]+"/"+d[0]+"/"+d[2]},b.guid=function(){return Math.floor(16777216*Math.random()).toString(16)},b.matchesElem=function(a,b){return!!$(a).parents(b).length},b.getTimeFromString=function(a,b){var c=a.trim().split(" "),d=c[0].split(":"),e=c[1].split("/"),f=d[0],g=d[1],h=d[2],i=d[3]||null,j=parseInt(e[0],10)-1,k=e[1],l=e[2],e=new Date(l,j,k,f,g,h,i);return e.getTime()+(b||0)},b.formatDate=function(a,b){return n("readableDateFilter")(a,null,c.GAME_TIMEZONE,c.GAME_TIME_OFFSET,b||"HH:mm:ss dd/MM/yyyy")},b.getTimeOffset=function(){return 1e3*a.gameDate().getTimezoneOffset()*60+c.GAME_TIME_OFFSET},b}),define("two/locale",["conf/locale","i18n"],function(a,b){function c(a,b,c){if(!d.hasOwnProperty(a))return console.error("Language for module "+a+" not created");var e=Array.from(arguments).slice(1),g=f[a];return d[a][g].apply(this,e)}var d={},e={},f={},g=a.LANGUAGE.split("_")[0],h=function(a){for(var b in a)return b};return c.create=function(a,c,i){if(d.hasOwnProperty(a))return!1;d[a]={};var j=c.hasOwnProperty(g),k=c.hasOwnProperty(i);e[a]=k?i:h(c),f[a]=j?g:e[a];for(var l in c)d[a][l]=b.create({values:c[l]})},c.change=function(a,b){d[a].hasOwnProperty(b)?f[a]=b:(console.error("Language "+b+" of module "+a+" not created. Selection default ("+e[a]+")"),f[a]=e[a])},c.current=function(a){return f[a]},c.eachLang=function(a,b){var c=d[a];for(var e in c)b(e,c[e]("langName"))},c}),define("two/ready",["conf/gameStates"],function(a){return function(b,e){e=e||["map"];var f=function(a){e=e.filter(function(b){return b!==a}),e.length||b()},h={map:function(){var a=document.querySelector("#map");if(angular.element(a).scope().isInitialized)return f("map");var b=c.$on(g.MAP_INITIALIZED,function(){b(),f("map")})},tribe_relations:function(){var a=d.getSelectedCharacter();if(a){if(a.getTribeRelations())return f("tribe_relations")}var b=c.$on(g.TRIBE_RELATION_LIST,function(){b(),f("tribe_relations")})},initial_village:function(){if(d.getGameState().getGameState(a.INITIAL_VILLAGE_READY))return f("initial_village");var b=c.$on(g.GAME_STATE_INITIAL_VILLAGE_READY,function(){b(),f("initial_village")})}};e.forEach(function(a){h[a]()})}}),require(["two/ready","Lockr","ejs"],function(a,b,e){a(function(){var a=d.getSelectedCharacter();e.delimiter="#",b.prefix=a.getId()+"_twOverflow_"+a.getWorldId()+"-",j.add("esc",function(){c.$broadcast(g.WINDOW_CLOSED,null,!0)},["INPUT","SELECT","TEXTAREA"])})}),require(["two/locale"],function(a){a.create("common",{en:{start:"Start",pause:"Pause",paused:"Paused",status:"Status",none:"None",info:"Information",settings:"Settings",others:"Others",villages:"Villages",registers:"Registers",filters:"Filters",add:"Add",waiting:"Waiting",attack:"Attack",support:"Support",relocate:"Transfer",activate:"Enable",deactivate:"Disable",units:"Units",officers:"Officers",origin:"Origin",target:"Target",save:"Save",logs:"Logs",headquarter:"Headquarters",barracks:"Barracks",tavern:"Tavern",hospital:"Hospital",preceptory:"Hall of Orders",chapel:"Chapel",church:"Church",academy:"Academy",rally_point:"Rally Point",statue:"Statue",market:"Market",timber_camp:"Timber Camp",clay_pit:"Clay Pit",iron_mine:"Iron Mine",farm:"Farm",warehouse:"Warehouse",wall:"Wall",spear:"Spearman",sword:"Swordsman",axe:"Axe Fighter",archer:"Archer",light_cavalry:"Light Cavalry",mounted_archer:"Mounted Archer",heavy_cavalry:"Heavy Cavalry",ram:"Ram",catapult:"Catapult",doppelsoldner:"Berserker",trebuchet:"Trebuchet",snob:"Nobleman",knight:"Paladin","no-results":"No results...",selected:"Selected",now:"Now"},pt:{start:"Iniciar",pause:"Pausar",paused:"Pausado",status:"Status",none:"Nenhum",info:"InformaÃ§Ãµes",settings:"ConfiguraÃ§Ãµes",others:"Outros",villages:"Aldeias",registers:"Registros",filters:"Filtros",add:"Adicionar",waiting:"Em espera",attack:"Ataque",support:"Apoio",relocate:"TransferÃªncia",activate:"Ativar",deactivate:"Desativar",units:"Unidades",officers:"Oficiais",origin:"Origem",target:"Alvo",save:"Salvar",logs:"Logs",headquarter:"EdifÃ­cio Principal",barracks:"Quartel",tavern:"Taverna",hospital:"Hospital",preceptory:"SalÃ£o das Ordens",chapel:"Capela",church:"Igreja",academy:"Academia",rally_point:"Ponto de Encontro",statue:"EstÃ¡tua",market:"Mercado",timber_camp:"Bosque",clay_pit:"PoÃ§o de Argila",iron_mine:"Mina de Ferro",farm:"Fazenda",warehouse:"ArmazÃ©m",wall:"Muralha",spear:"Lanceiro",sword:"Espadachim",axe:"Viking",archer:"Arqueiro",light_cavalry:"Cavalaria Leve",mounted_archer:"Arqueiro Montado",heavy_cavalry:"Cavalaria Pesada",ram:"ArÃ­ete",catapult:"Catapulta",doppelsoldner:"Berserker",trebuchet:"Trabuco",snob:"Nobre",knight:"Paladino","no-results":"Sem resultados...",selected:"Selecionado",now:"Agora"}},"en")}),define("two/attackView",["two/queue","two/eventQueue","two/ready","models/CommandModel","conf/unitTypes","Lockr","helper/math","helper/mapconvert","struct/MapData"],function(a,b,h,i,j,k,l,m,n){var o,p={ORIGIN_VILLAGE:"origin_village_name",COMMAND_TYPE:"command_type",TARGET_VILLAGE:"target_village_name",TIME_COMPLETED:"time_completed",COMMAND_PROGRESS:"command_progress",ORIGIN_CHARACTER:"origin_character_name"},q={ATTACK:"attack",SUPPORT:"support",RELOCATE:"relocate"},r={COMMAND_TYPES:"commandTypes",VILLAGE:"village"},s=!1,t={},u=injector.get("overviewService"),v=[],w={},x={},y={reverse:!1,column:p.COMMAND_PROGRESS},z=function(){var a,b,c=[r.COMMAND_TYPES],e=d.getSelectedVillage().getId(),f={};for(a=0;a<c.length;a++)for(b in w[c[a]])if(f[c[a]]||(f[c[a]]=[]),w[c[a]][b])switch(c[a]){case r.COMMAND_TYPES:"ATTACK"===b?f[c[a]].push(q.ATTACK):"SUPPORT"===b?f[c[a]].push(q.SUPPORT):"RELOCATE"===b&&f[c[a]].push(q.RELOCATE)}x=f,x.village=w[r.VILLAGE]?[e]:[]},A=function(a,c){c?w[a][c]=!w[a][c]:w[a]=!w[a],z(),b.trigger("attackView/filtersChanged")},B=function(){I()},C=function(a,c){b.trigger("attackView/commandCancelled",[c.id||c.command_id])},D=function(a,c){for(var d=0;d<v.length;d++)v[d].command_id===c.command_id&&v.splice(d,1);b.trigger("attackView/commandIgnored",[c.command_id])},E=function(a,c){for(var d=0;d<v.length;d++)v[d].target_village_id===c.village_id&&(v[d].target_village_name=c.name,v[d].targetVillage.name=c.name);b.trigger("attackView/villageRenamed",[c])},F=function(a,b){x[r.VILLAGE].length&&(x[r.VILLAGE]=[b],I())},G=function(){k.set("attackView-filters",w),I()},H=function(a){v=a.commands;for(var c=0;c<v.length;c++)u.formatCommand(v[c]),v[c].slowestUnit=J(v[c]);b.trigger("attackView/commandsLoaded",[v])},I=function(){var a=o.getCommandListModel().getIncomingCommands().length,b=a>25?a:25;e.emit(f.OVERVIEW_GET_INCOMING,{count:b,offset:0,sorting:y.column,reverse:y.reverse?1:0,groups:[],command_types:x[r.COMMAND_TYPES],villages:x[r.VILLAGE]},H)},J=function(b){var c=b.model.duration,d={},e={x:b.origin_x,y:b.origin_y},f={x:b.target_x,y:b.target_y},g=[];return[j.AXE,j.SWORD,j.LIGHT_CAVALRY,j.HEAVY_CAVALRY,j.RAM,j.SNOB,j.TREBUCHET].forEach(function(h){d[h]=1,g.push({unit:h,duration:a.getTravelTime(e,f,d,b.command_type,{})-c})}),g=g.map(function(a){return a.duration=Math.abs(a.duration),a}).sort(function(a,b){return a.duration-b.duration}),g[0].unit},K=function(){return v},L=function(){return w},M=function(){t[g.COMMAND_INCOMING]=c.$on(g.COMMAND_INCOMING,B),t[g.COMMAND_CANCELLED]=c.$on(g.COMMAND_CANCELLED,C),t[g.MAP_SELECTED_VILLAGE]=c.$on(g.MAP_SELECTED_VILLAGE,F),t[g.VILLAGE_NAME_CHANGED]=c.$on(g.VILLAGE_NAME_CHANGED,E),t[g.COMMAND_IGNORED]=c.$on(g.COMMAND_IGNORED,D)},N=function(){for(var a in t)t[a]()},O=function(a,b){return a.sort(function(a,c){return l.actualDistance(b,a)-l.actualDistance(b,c)})},P=function(a,b){if(n.hasTownDataInChunk(a.x,a.y)){var c,e,f,g=n.loadTownData(a.x,a.y,25,25,25),h=[],i=[],j=[],k=[],l=d.getSelectedCharacter().getTribeId(),o=d.getSelectedCharacter().getId();if(g.forEach(function(a){for(e in a.data)for(f in a.data[e])h.push(a.data[e][f])}),i=h.filter(function(a){return null===a.character_id&&a.id>0}),j=h.filter(function(b){return b.character_id===o&&a.id!==b.id}),l&&(k=h.filter(function(a){return l&&a.tribe_id===l})),i.length)c=O(i,a);else if(j.length)c=O(j,a);else{if(!k.length)return b(!1);c=O(k,a)}return b(c[0])}var p=m.scaledGridCoordinates(a.x,a.y,25,25,25),q=0;n.loadTownDataAsync(a.x,a.y,25,25,function(){++q===p.length&&P(a,b)})},Q=function(b,c){P(b.targetVillage,function(d){var e=b.targetVillage,f=d,g=null===f.character_id?"attack":"support";a.addCommand({origin:e,target:f,date:c,dateType:"out",units:{spear:"*",sword:"*",axe:"*",archer:"*",light_cavalry:"*",mounted_archer:"*",heavy_cavalry:"*",ram:"*",catapult:"*",snob:"*",knight:"*",doppelsoldner:"*",trebuchet:"*"},officers:{},type:g,catapultTarget:"wall"}),console.log("Queue.isRunning()",a.isRunning()),a.isRunning()||(console.log("start queue!"),a.start())})};return{init:function(){s=!0,o=d.getSelectedCharacter().getGlobalInfo(),w=k.get("attackView-filters",{commandTypes:{ATTACK:!0,SUPPORT:!0,RELOCATE:!0},village:!1},!0),h(function(){z()},["initial_village"]),b.bind("attackView/filtersChanged",G)},version:"0.0.1-alpha",loadCommands:I,getCommands:K,getFilters:L,toggleFilter:A,FILTER_TYPES:r,COMMAND_TYPES:q,registerListeners:M,unregisterListeners:N,setQueueCommand:Q}}),require(["two/ready","two/attackView","two/attackView/ui"],function(a,b){if(b.initialized)return!1;a(function(){b.init(),b.interface()})}),define("two/attackView/ui",["two/attackView","two/queue","two/locale","two/ui","two/FrontButton","two/utils","two/eventQueue","helper/time","conf/unitTypes","ejs"],function(a,b,e,f,i,j,k,l,n,o){var p,q,r,s,t,u,v,w=function(){for(var b,c=a.getCommands(),d=.001*Date.now(),e=0;e<c.length;e++)b=c[e].model.percent(),100!==b?(c[e].$arrivalProgress.style.width=b+"%",c[e].$arrivalIn.innerHTML=l.readableSeconds(l.server2ClientTimeInSeconds(c[e].time_completed-d))):c[e].$command.remove()},x=function(b){s.children().remove();var c=.001*Date.now();if(!b.length)return t.css("display","");t.hide(),b.forEach(function(b){var d=document.createElement("tr"),e=j.formatDate(1e3*b.time_completed,"HH:mm:ss dd/MM/yyyy"),f=l.readableSeconds(l.server2ClientTimeInSeconds(b.time_completed-c)),g=1e3*(b.time_completed-b.time_start),i=j.formatDate(g,"HH:mm:ss dd/MM/yyyy"),k="command-"+b.command_id+" "+b.command_type;b.slowestUnit===n.SNOB&&(k+=" snob"),d.className=k,d.innerHTML=o.render('<td class="commandType"><span class="icon-20x20-<#= commandType #>"></span></td><td class="originCharacter character player-<#= originCharacter.id #>"><span class="name"><#= originCharacter.name #> </span></td><td class="originVillage village village-<#= originVillage.id #>"><span class="name"><#= originVillage.name #></span><span class="coords"> <#= originVillage.x #>|<#= originVillage.y #></span></td><td class="targetVillage village village-<#= targetVillage.id #>"><span class="name"><#= targetVillage.name #></span><span class="coords"> <#= targetVillage.x #>|<#= targetVillage.y #></span></td><td><span class="icon-20x20-unit-<#= slowestUnit #>"></span></td><td><div class="progress-wrapper" tooltip="<#= arrivalDate #>"><div class="progress-bar arrivalProgress" style="width:<#= progress #>%"></div><div class="progress-text"><span class="arrivalIn"><#= arrivalIn #></span></div></div></td><td class="actions"><a class="copyArriveTime btn btn-orange size-20x20 icon-20x20-arrivetime" tooltip="Copy arrival date"></a> <a class="copyBackTime btn btn-red size-20x20 icon-20x20-backtime" tooltip="Copy backtime date"></a> <a class="removeTroops btn btn-orange size-20x20 icon-20x20-units-outgoing" tooltip="Set a CommandQueue to remove all troops before the attack hit"></a></td>',{originCharacter:b.originCharacter,originVillage:b.originVillage,targetVillage:b.targetVillage,arrivalDate:e,arrivalIn:f,slowestUnit:b.slowestUnit,progress:b.model.percent(),commandType:b.command_type});var p=d.querySelector(".originCharacter .name"),q=d.querySelector(".originVillage .name"),r=d.querySelector(".originVillage .coords"),t=d.querySelector(".targetVillage .name"),u=d.querySelector(".targetVillage .coords"),v=d.querySelector(".arrivalProgress"),w=d.querySelector(".arrivalIn"),x=d.querySelector(".removeTroops"),y=d.querySelector(".copyArriveTime"),z=d.querySelector(".copyBackTime");p.addEventListener("click",function(){h.openCharacterProfile(b.originCharacter.id)}),q.addEventListener("click",function(){h.openVillageInfo(b.originVillage.id)}),r.addEventListener("click",function(){m.jumpToVillage(b.originVillage.x,b.originVillage.y)}),t.addEventListener("click",function(){h.openVillageInfo(b.targetVillage.id)}),u.addEventListener("click",function(){m.jumpToVillage(b.targetVillage.x,b.targetVillage.y)}),x.addEventListener("click",function(){var c=j.formatDate(1e3*(b.time_completed-10),"HH:mm:ss:sss dd/MM/yyyy");a.setQueueCommand(b,c)}),y.addEventListener("click",function(){document.execCommand("copy")}),y.addEventListener("copy",function(a){a.preventDefault(),a.clipboardData.setData("text/plain",e),j.emitNotif("success","Arrive time copied!")}),z.addEventListener("click",function(){document.execCommand("copy")}),z.addEventListener("copy",function(a){a.preventDefault(),a.clipboardData.setData("text/plain",i),j.emitNotif("success","Back time copied!")}),s.append(d),b.$command=d,b.$arrivalProgress=v,b.$arrivalIn=w}),p.setTooltips(),p.recalcScrollbar(),D()},y=function(a){s.find(".command-"+a).remove(),p.recalcScrollbar()},z=function(a){s.find(".command-"+a).remove(),p.recalcScrollbar()},A=function(a){var b=".village-"+a.village_id+" .name";s.find(b).html(a.name)},B=function(b,c){a.getFilters()[a.FILTER_TYPES.VILLAGE]||D(c)},C=function(){s.find(".village.selected").removeClass("selected")},D=function(a){C(),a=a||d.getSelectedVillage().getId(),s.find(".village-"+a).addClass("selected")},E=function(){var b,c,d,e=a.getFilters()
;for(b in e)if(angular.isObject(e[b]))for(c in e[b])d=e[b][c]?"addClass":"removeClass",u[b][c][d]("active");else d=e[b]?"addClass":"removeClass",u[b][d]("active")},F=function(){return p=new f("AttackView",{template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2>AttackView <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="win-main"><div class="box-paper"><table class="filters tbl-border-light"><tbody><tr><td><div class="box-border-dark icon village" tooltip="Current village only"><span class="icon-34x34-village-info icon-bg-black"></span></div><div data-filter="ATTACK" class="box-border-dark icon commandTypes attack" tooltip="Show attacks"><span class="icon-34x34-attack icon-bg-black"></span></div><div data-filter="SUPPORT" class="box-border-dark icon commandTypes support" tooltip="Show supports"><span class="icon-34x34-support icon-bg-black"></span></div><div data-filter="RELOCATE" class="box-border-dark icon commandTypes relocate" tooltip="Show relocations"><span class="icon-34x34-relocate icon-bg-black"></span></div></td></tr></tbody></table><table class="tbl-border-light commands-table"><colgroup><col width="4%"><col width="14%"><col width=""><col width=""><col width="4%"><col width="12%"><col width="11%"></colgroup><thead><tr><th tooltip="Command Type">CT</th><th>Player</th><th>Origin</th><th>Target</th><th tooltip="Slowest Unit">SU</th><th>Arrive</th><th>Actions</th></tr></thead><tbody class="commands"></tbody><tbody class="empty"><tr><td colspan="7">No commands incoming.</td></tr></tbody></table></div></div></div>',replaces:{version:a.version,author:{name:"Robson Pereira",email:"robsonpereira80@bol.com.br",url:"https://github.com/robsonpereira80"},locale:e},css:'#AttackView table.commands-table{table-layout:fixed;font-size:13px}#AttackView table.commands-table th{text-align:center;padding:0}#AttackView table.commands-table td{padding:1px 0;min-height:initial;border:none;text-align:center}#AttackView table.commands-table tr.attack.snob td{background:#bb8658}#AttackView table.commands-table tr.support td,#AttackView table.commands-table tr.relocate td{background:#9c9368}#AttackView table.commands-table .empty td{height:32px}#AttackView .village .coords{font-size:11px;color:#71471a}#AttackView .village .coords:hover{color:#ffde00;text-shadow:0 1px 0 #000}#AttackView .village .name:hover{color:#fff;text-shadow:0 1px 0 #000}#AttackView .village.selected .name{font-weight:bold}#AttackView .character .name:hover{color:#fff;text-shadow:1px 1px 0 #000}#AttackView .progress-wrapper{height:20px;margin-bottom:0}#AttackView .progress-wrapper .progress-text{position:absolute;width:100%;height:100%;text-align:center;z-index:10;padding:0 5px;line-height:20px;color:#f0ffc9;overflow:hidden}#AttackView .filters{margin-bottom:10px}#AttackView .filters .icon{width:38px;float:left;margin:0 6px}#AttackView .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#AttackView .filters td{padding:6px}#AttackView .icon-20x20-backtime{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAEMklEQVQ4y42US2xUdRTGf3funZn/PHqnnVdpKZZ2RCWBVESgoZogSAKKEEAlGhVNLMGg0QiJKxYudIdoTEyDj8SFGo2seDUGhEQqRHk/UimDpdAptHMr8+jM3Dv35QJbi9KEszzJ+eU753z5JKYuOQGBUpAa2SLiuPgBPBKGrZAPlSlmoQLYk4ekqUCmEHHL0pslRb7fsNwWF8L/DIz5Fanftey0oogBr65rk8HS3WC6jyY8ckfZdNtfWdX++tzGIDMabAJmArte4my/l/c//vaLoFc6jmP3iCqD41B5Mi0BId1Hk+V6ljfEQlvWL2xZoY/lKOTLGCY01tZhVLMkRJEtqzoeyUvSnN70SNZRXC1iUylDVZmszhQiDmbH9Lrgpta4mKPlCjy95D6Wrn8GAKFEEfEmdG2Qowd+4I0XFrUC7+w7eL5sCu8hdL3imaQuYFl6c9l021vjYk7Y72Xjq4/z1IaNCCVKMRckq+moiQDJ2bN48uV3GbnSx9b1ra1l0223LL05AYF/Vw4S80jyonnN6paq5YTe3LyU2rpaYrFpJGfPItlcTzI1H8R8cC38NTFiaojhSzeJJ8KNJ/4YOmP43GsTCmWLiGG5LTUBb2LuzGm3e3Ij3321m5Hey6A0AVAcPjmhQcSbuDyU5sF6e5phuS2yRWQC6Lj4x62h1vjJ3BwjlUoiYn52ffolmUtnuXj4ADu2b7/DFoN9RVQ1gAthx8U/+Sk4LiGAQtFAHzXIajpr16yiu/tX98euzyWAzrc6Abj8+1G0TIZ8uYx/xJpgjANlWfEKqjaZbIlixQQgdDHDyuULWLFisZTVdBJxQTIVA2uQ+qZ6KoU0nhqV09f+QoIxj4ThAWRVJWLZToNXUaarYR8Hdm+iZBic7N5LbmgI0xclERcAFLIVAHRtkFOHjwBwNHNryK9I/bZCXlFVIk6ZuSbukidmR1Z+/cliAHzRBjKjBTq37bz9gEAAgA+2vQjAjb4j9F6pUCga/Hzm5v6A5KRDFkXF1UnWRcRj256d/vam9zrJXT0GwGc7V+ONRwAwtTwAa9bs4ND+PTy8MMW5az7+vJ7lXKZ4IeiVjsuIgaylVxTHxf/S84+u3bh5Mbmrx/D6Y1hjGtaYBjduH9g0RonNSmH4o/T1j9JzeoBixSRbsi9ktNIuRXJ6vFVbA2ypVoiZNuay+qj62r6u1R0ee4i65Iw7rDEOnLegC4CSqwxf18b23C0cFMenF5wKJzLZfLDtuW/4pWt1Ry6XY8/ug8jRB6gN3GI0k6VtXcq9csvqtm2rTyjS+YDkpGXEgLdq/z++EhA2hYjbmMtMx7P8+4/Wbdj64U89/cP5Xlli2HGcUsAnjziulMGxbrheRu4lYH21QjSarvXQoraZbQC/nUoflzwMyx6hVz26MRVkysROQNhQ8XmqQr1XwH/rb2Du69Eebp25AAAAAElFTkSuQmCC")}#AttackView .icon-20x20-arrivetime{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAEW0lEQVQ4y4WUWWxUZRiGn7PMnNPOVtvODHQBSlulAUFBoQiEaBHBhCsSFaIhIe6JSyAkRkO8NpErY2KoYuINISkkRFAjEUyAUCQsBSu1BVpKZ2DmTNuZzsyZMz3L70Vbgkjqe/Ul//89//K9eSX+KyUKFcVKQopDxBNoALJE2VXJBUzyBpQA9xG9SA+DbF2vdRxrvqQqLWVHNAkITm8saKo0KBz3hqrqt32WlXkUWHoQZvlpQFbWmLZo//zj7W8ua7JRUoKSz+DOXYVrSZMfjnV/W+mTuvHcs/okIw9DFYAoBCw/DY6QX9yycemer9/p6KiQE7ilIj4vwNXBFIO3M1iFLKta4suNvLUwZzpZTxWZiEvJhMkHgYpf1+cKSazfsnHpnve2rVqYTg2xdvMrPL76JWKNNSxesYB1LyyDiQQ9fWkCmhxzkRuLZTcpVC1lOU4eEDNPDUzitJVc6eUDn6zuSAwl2PDGLqrnx9ECPob6kkxaPiLBEK1LniIaFVz/c4SAJsf6U2ZaEfZwxMOYuaVCJTWypKz68LXV7y6sigWf7thMdfMKkMOgryA2r5pYYwWBaA3FzBhFM8uiRXFOnumn/jGt0SjYl8t+MWzbFABkxSFSdkTTE3F3zkDyBnptw/2J5VMXpwq1gfT1AQ4eOIyi1AHw5II5hCp80bIjmhSHyEyP7Ak0AcFwuIKR/vy/PLVv7156T/1M4u8e9n/1HXqNRnNzjMS9AuGQBlMfF5zxKoA6U2hph5xp0nv+ErX1KVqfXctbH+yk65tOAOa1tolNm56TjIyFNVpmIl8GwBMEHnSzKkuUJUHh8vAYcihMIFQi3hAHZ4T65hq27dyKkbGI1uqS7a/mXO8F+gZGuDZ0j4nClFsU1adj2wrgyq5KTlOlwTOJ8STApVO/Y2VGAJgwSgBEa3VsfzXZZJKLvxyjWC7z8+G3CQf9+FS13nG9ueEwEUBRqmywEfrAvWLF4rqq5fmiwCvcIjuqYCTu8v5nnXQd7+bgoZ/48dduXF8F4ZpaNj0/j60bgly+YLTeNMyUYosxPUhONaBUpeq3K7G7T/Ym2pfWh5ZU1MzBX/0XV/64iVYe4+jR3QD4aqeGaWdylPNjABw9upv9X3R+9GVXwsjmrZQCiJDjOI4scjnTyZZc0ZhKJmM9PcNYlsu4CLJjez3jt65ij45jpZPYhVG8SRNFrcQc7eeZ9evIl9xI96Xh4yqAAaXoJCOW3zuRGjfNwbRob6wNbkkYxTizaDx9B0+pY93rnWdTYxPf+xQ9p0yvCRPciEtJqFpKEfZwyXaupArOYLbM+JK2lS3HDhyRbgwanO6eoPvEaWLxOixLY+WOrrP5onUI4Z2TdMeQZgtYySaGrM6VJVFfmnRjsiwHXEG8KR5p2/fpxjWv7jpyyCd7JxR8v03nY0Fidt2H+z1dcz1LFx7xlctb2gHO9wz1+CS1L2tZSabD4f+Asx7g+a0JbYJJg6lgAPgHUh4QWRIJr4EAAAAASUVORK5CYII=")}',onClose:function(){a.unregisterListeners()}}),q=new i("AttackView",{onClick:function(){a.registerListeners(),a.loadCommands(),w(),p.openWindow()},classHover:!1,classBlur:!1}),r=$(p.$window),s=r.find(".commands"),t=r.find(".empty"),v=r.find(".filters"),u={village:v.find(".village"),commandTypes:{ATTACK:v.find(".attack"),SUPPORT:v.find(".support"),RELOCATE:v.find(".relocate")}},u.village.on("click",function(){a.toggleFilter(a.FILTER_TYPES.VILLAGE)}),v.find(".commandTypes").on("click",function(){a.toggleFilter(a.FILTER_TYPES.COMMAND_TYPES,this.dataset.filter)}),setInterval(function(){p.isVisible("attacks")&&w()},1e3),k.bind("attackView/commandsLoaded",x),k.bind("attackView/commandCancelled",y),k.bind("attackView/commandIgnored",z),k.bind("attackView/villageRenamed",A),k.bind("attackView/filtersChanged",E),c.$on(g.MAP_SELECTED_VILLAGE,B),E(),p};a.interface=function(){a.interface=F()}}),define("two/autoCollector",["two/locale","two/eventQueue","helper/time","Lockr"],function(a,b,h,i){var j=!1,k=!1,l=!0,m=0,o=function(a){e.emit(f.RESOURCE_DEPOSIT_START_JOB,{job_id:a.id})},p=function(a){e.emit(f.RESOURCE_DEPOSIT_COLLECT,{job_id:a.id,village_id:d.getSelectedVillage().getId()})},q=function(){e.emit(f.RESOURCE_DEPOSIT_GET_INFO,{})},r=function(){if(!k)return!1;var a=d.getSelectedCharacter().getResourceDeposit();if(!a)return!1;if(a.getCurrentJob())return!1;var b=a.getCollectibleJobs();if(b)return p(b.shift());var c=a.getReadyJobs();return c?o(s(c)):void 0},s=function(a){return a.sort(function(a,b){return a.duration-b.duration})[0]},t=function(a){var b=1e3*a.time_next_reset-Date.now()+1e3;clearTimeout(m),m=setTimeout(q,b),console.log("rerollUpdater()",n("readableMillisecondsFilter")(b))},u={};return u.init=function(){a.create("collector",{en:{title:"AutoCollector",description:"Automatic Resource Deposit/Second Village collector.",activated:"Automatic Collector activated",deactivated:"Automatic Collector deactivated"},pt:{title:"AutoCollector",description:"Coletor automÃ¡tico para DepÃ³sito de Recursos/Segunda Aldeia.",activated:"Coletor AutomÃ¡tico ativado",deactivated:"Coletor AutomÃ¡tico desativado"}},"en"),j=!0,c.$on(g.RESOURCE_DEPOSIT_JOB_COLLECTIBLE,function(){if(!l||!k)return!1;l=!1,setTimeout(function(){l=!0,r()},1500)}),c.$on(g.RESOURCE_DEPOSIT_JOBS_REROLLED,r),c.$on(g.RESOURCE_DEPOSIT_JOB_COLLECTED,r),c.$on(g.RESOURCE_DEPOSIT_INFO,function(a,b){r(),t(b)}),i.get("collector-active",!1,!0)&&u.start()},u.start=function(){i.set("collector-active",!0),b.trigger("collector/started"),k=!0,r()},u.stop=function(){i.set("collector-active",!1),b.trigger("collector/stopped"),k=!1},u.isRunning=function(){return k},u.isInitialized=function(){return j},u}),define("two/autoCollector/secondVillage",["two/autoCollector","helper/time"],function(a,b){var h,i,j=!1,k=!1,l=!1,m=null,n=injector.get("secondVillageService"),o=function(){if(!k)return!1;var a=p();return a?(setTimeout(function(){v()},1e3*a.time_completed-Date.now()),!1):q()?r():s()?t():void 0},p=function(){var a=n.getJobInProgress(h);if(a in n.getCollectedJobs(h))return!1;if(!(a in h))return!1;var c=1e3*h[a].time_completed;return b.gameTime()<c&&h[a]},q=function(){var a=n.getJobInProgress(h),b=n.getCollectedJobs(h);return!!a&&!(p()||a in b)},r=function(){var a=n.getJobInProgress(h);e.emit(f.SECOND_VILLAGE_COLLECT_JOB_REWARD,{job_id:h[a].id,village_id:d.getSelectedVillage().getId()},function(){v()})},s=function(){var a=n.getCurrentDayJobs(h,i);for(var b in a)if(!a[b].collected)return!0;return!1},t=function(){var a=n.getCurrentDayJobs(h,i),b=u(a);if(!b)return!1;e.emit(f.SECOND_VILLAGE_START_JOB,{job_id:b.id,village_id:d.getSelectedVillage().getId()},function(){v(),setTimeout(v,1e3*b.duration+3e3)})},u=function(){var a=n.getCurrentDayJobs(h,i),b=n.getCollectedJobs(h),c=d.getSelectedVillage().getResources().getResources(),e=n.getAvailableJobs(a,b,c,[]);for(var f in e)return e[f];return!1},v=function(a){e.emit(f.SECOND_VILLAGE_GET_INFO,{},function(b){h=b.jobs,i=b.day,a&&a()})},w={};w.init=function(){if(j=!0,!n.isFeatureActive())return!1;l=!0,c.$on(g.SECOND_VILLAGE_JOB_COLLECTED,o),c.$on(g.SECOND_VILLAGE_VILLAGE_CREATED,o)},w.start=function(){if(!l)return!1;k=!0,m=setInterval(o,6e4),v(o)},w.stop=function(){if(!l)return!1;k=!1,clearInterval(m)},w.isRunning=function(){return l&&k},w.isInitialized=function(){return j},a.secondVillage=w}),require(["two/ready","two/autoCollector","two/autoCollector/secondVillage","two/autoCollector/ui"],function(a,b){if(b.isInitialized())return!1;a(function(){b.init(),b.secondVillage.init(),b.interface()})}),define("two/autoCollector/ui",["two/autoCollector","two/FrontButton","two/locale","two/utils","two/eventQueue"],function(a,b,c,d,e){function f(){return g=new b("Collector",{classHover:!1,classBlur:!1,tooltip:c("collector","description")}),g.click(function(){a.isRunning()?(a.stop(),a.secondVillage.stop(),d.emitNotif("success",c("collector","deactivated"))):(a.start(),a.secondVillage.start(),d.emitNotif("success",c("collector","activated")))}),e.bind("collector/started",function(){g.$elem.removeClass("btn-green").addClass("btn-red")}),e.bind("collector/stopped",function(){g.$elem.removeClass("btn-red").addClass("btn-green")}),a.isRunning()&&e.trigger("collector/started"),g}var g;a.interface=function(){a.interface=f()}}),define("two/farm",["two/locale","two/farm/Village","two/utils","two/eventQueue","helper/math","conf/conf","struct/MapData","helper/mapconvert","helper/time","conf/locale","conf/gameStates","Lockr"],function(a,b,h,j,k,l,m,n,o,p,q,r){var s,t,u,v,w,x,y=!1,z=/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,A=null,B=[],C=null,D=null,E={},F=null,G=!0,H=!0,I=[],J=null,K=null,L=null,M=[],N=[],O={},P=!1,Q="",R={},S="paused",T=[function(a){if(a.id<0)return!0},function(a){if(a.character_id===w.getId())return!0},function(a){if(a.attack_protection)return!0},function(a){if(a.character_id){if(!N.includes(a.id))return!0}},function(a){return a.points<xa.settings.minPoints||(a.points>xa.settings.maxPoints||void 0)},function(a){var b=C.position,c=k.actualDistance(b,a);return c<xa.settings.minDistance||(c>xa.settings.maxDistance||void 0)}],U=function(a){var b={};for(var c in a)a[c]>0&&(b[c]=a[c]);return b},V=function(){r.set("farm-lastEvents",s)},W=function(){var a=d.getGroupList().getGroups();J=xa.settings.groupIgnore in a&&a[xa.settings.groupIgnore],K=xa.settings.groupInclude in a&&a[xa.settings.groupInclude],L=xa.settings.groupOnly in a&&a[xa.settings.groupOnly]},X=function(){var a=d.getGroupList();M=[],N=[],J&&(M=a.getGroupVillageIds(J.id)),K&&(N=a.getGroupVillageIds(K.id))},Y=function(){var a=w.getVillageList().map(function(a){return new b(a)}).filter(function(a){return!M.includes(a.id)});if(L){var c=d.getGroupList(),e=c.getGroupVillageIds(L.id);a=a.filter(function(a){return e.includes(a.id)})}if(A=a,D=1===A.length,C=A[0],xa.commander.running&&P)for(var f=0;f<a.length;f++){var g=a[f];if(!O[g.id]){P=!1,xa.commander.analyse();break}}xa.triggerEvent("Farm/villagesUpdate")},Z=function(a){var b=function(b){if(I=[],!xa.settings.presetName)return void(a&&a());for(var c in b)if(b.hasOwnProperty(c)){var d=b[c].name,e=d.replace(z,"").trim();e===xa.settings.presetName&&(b[c].cleanName=e,b[c].units=U(b[c].units),I.push(b[c]))}a&&a()};d.getPresetList().isLoaded()?b(d.getPresetList().getPresets()):e.emit(f.GET_PRESETS,{},function(a){xa.triggerEvent("Farm/presets/loaded"),b(a.presets)})},$=function(){var a=[],b=function(a){var b=ka(a.target_village_id);return!!b&&(ja(b),!0)},d=function(a){oa(a.id,function(a){var b=a.ReportAttack,c=b.attVillageId,d=b.defVillageId;if(R.hasOwnProperty(c)||(R[c]=[]),R[c].includes(d))return!1;R[c].push(d),xa.triggerEvent("Farm/priorityTargetAdded",[{id:d,name:b.defVillageName,x:b.defVillageX,y:b.defVillageY}])})},e=function(){a.forEach(function(a){d(a)}),a=[]},f=function(c,e){if(!xa.commander.running||"attack"!==e.type)return!1;xa.settings.ignoreOnLoss&&1!==e.result&&b(e),xa.settings.priorityTargets&&"full"===e.haul&&(i.isTemplateOpen("report")?a.push(e):d(e))},h=function(a,b){"report"===b&&e()};c.$on(g.REPORT_NEW,f),c.$on(g.WINDOW_CLOSED,h)},_=function(){var a=function(a,b){var c=xa.settings.remoteId;if(1!==b.participants.length||b.title!==c)return!1;switch(b.message.content.trim().toLowerCase()){case"on":case"start":case"init":case"begin":xa.restart(),pa(b.message_id,qa()),xa.triggerEvent("Farm/remoteCommand",["on"]);break;case"off":case"stop":case"pause":case"end":xa.tempDisableNotifs(function(){xa.pause()}),pa(b.message_id,qa()),xa.triggerEvent("Farm/remoteCommand",["off"]);break;case"status":case"current":pa(b.message_id,qa()),xa.triggerEvent("Farm/remoteCommand",["status"])}return!1};c.$on(g.MESSAGE_SENT,a)},aa=function(){var a=function(){if(Z(),xa.triggerEvent("Farm/presets/change"),xa.commander.running){!!I.length?xa.getGlobalWaiting()&&(la(),xa.restart()):(xa.triggerEvent("Farm/noPreset"),xa.pause())}};c.$on(g.ARMY_PRESET_UPDATE,a),c.$on(g.ARMY_PRESET_DELETED,a)},ba=function(){var a=function(){W(),X(),xa.triggerEvent("Farm/groupsChanged")},b=function(a,b){if(Y(),!K)return!1;K.id===b.group_id&&(E={})};c.$on(g.GROUPS_UPDATED,a),c.$on(g.GROUPS_CREATED,a),c.$on(g.GROUPS_DESTROYED,a),c.$on(g.GROUPS_VILLAGE_LINKED,b),c.$on(g.GROUPS_VILLAGE_UNLINKED,b)},ca=function(){var a=function(a){if(delete O[a],P){if(P=!1,xa.settings.stepCycle)return!1;xa.commander.running&&(ha(a),xa.commander.analyse())}},b=function(b,c){var d=c.village_id,e=O[d]||!1;if("units"===e||"commands"===e)return a(d),!1},d=function(b,c){var d=c.villageId;if("fullStorage"===(O[d]||!1))a(d);else{var e=ga(d);xa.isFullStorage(e)&&xa.setWaitingVillage(d,"fullStorage")}};c.$on(g.VILLAGE_ARMY_CHANGED,b),c.$on(g.VILLAGE_RESOURCES_CHANGED,d)},da=function(){var a=function(){xa.commander.running&&setTimeout(function(){xa.restart()},5e3)};m.setRequestFn(function(a){e.emit(f.MAP_GETVILLAGES,a)}),c.$on(g.RECONNECT,a)},ea=function(){j.bind("Farm/sendCommand",function(){fa(),S="attacking"}),j.bind("Farm/noPreset",function(){S="paused"}),j.bind("Farm/noUnits",function(){S="noUnits"}),j.bind("Farm/noUnitsNoCommands",function(){S="noUnitsNoCommands"}),j.bind("Farm/start",function(){S="attacking"}),j.bind("Farm/pause",function(){S="paused"}),j.bind("Farm/loadingTargets/start",function(){S="loadingTargets"}),j.bind("Farm/loadingTargets/end",function(){S="analyseTargets"}),j.bind("Farm/commandLimit/single",function(){S="commandLimit"}),j.bind("Farm/commandLimit/multi",function(){S="noVillages"}),j.bind("Farm/stepCycle/end",function(){S="stepCycle/end",H&&xa.settings.stepCycleNotifs&&h.emitNotif("error",a("farm","events.stepCycle/end"))}),j.bind("Farm/stepCycle/end/noVillages",function(){S="stepCycle/end/noVillages",H&&h.emitNotif("error",a("farm","events.stepCycle/end/noVillages"))}),j.bind("Farm/stepCycle/next",function(){if(S="stepCycle/next",H&&xa.settings.stepCycleNotifs){var b=o.gameTime()+xa.cycle.getInterval();h.emitNotif("success",a("farm","events.stepCycle/next",{time:h.formatDate(b)}))}}),j.bind("Farm/fullStorage",function(){S="fullStorage"})},fa=function(){u=o.gameTime(),r.set("farm-lastAttack",u)},ga=function(a){var b=A.indexOf(a);return-1!==b&&A[b]},ha=function(a){var b=ga(a);return!!b&&(C=b,!0)},ia=function(a,b){e.emit(f.ASSIGN_PRESETS,{village_id:C.id,preset_ids:a},b)},ja=function(a){if(!J)return!1;e.emit(f.GROUPS_LINK_VILLAGE,{group_id:J.id,village_id:a.id},function(){xa.triggerEvent("Farm/ignoredVillage",[a])})},ka=function(a){for(var b in E)for(var c=E[b],d=0;d<c.length;d++){var e=c[d];if(e.id===a)return e}return!1},la=function(){O={}},ma=function(){setInterval(function(){if(xa.commander.running){var a=3e5;xa.settings.stepCycle&&xa.cycle.intervalEnabled()&&(a+=xa.cycle.getInterval()+6e4);o.gameTime()-u>a&&xa.tempDisableNotifs(function(){xa.pause(),xa.start(!0)})}},6e4)},na=function(){setInterval(function(){E={}},3e5)},oa=function(a,b){e.emit(f.REPORT_GET,{id:a},b)},pa=function(a,b){e.emit(f.MESSAGE_REPLY,{message_id:a,message:b})},qa=function(){var b=a("common","status"),c=a("farm","events.selectedVillage"),d=a("farm","events.lastAttack"),e={};if("stepCycle/next"===S){var f=o.gameTime()+xa.cycle.getInterval();e.time=h.formatDate(f)}var g=a("farm","events."+S,e),i=h.genVillageLabel(C),j=h.formatDate(u),k=C.id,l=[];return l.push("[b]",b,":[/b] ",g,"[br]"),l.push("[b]",c,":[/b] "),l.push("[village=",k,"]",i,"[/village][br]"),l.push("[b]",d,":[/b] ",j),l.join("")},ra=function(){var a=o.gameTime();if(xa.settings.stepCycle&&xa.cycle.intervalEnabled()){if(a>t+xa.cycle.getInterval()+6e4)return!0}else if(a>t+18e5)return!0;return!1},sa=function(a,b,c,d,e,f){if(m.hasTownDataInChunk(a,b)){var g=m.loadTownData(a,b,c,d,e);return f(g)}xa.triggerEvent("Farm/loadingTargets/start");var h=n.scaledGridCoordinates(a,b,c,d,e),i=h.length,j=0;m.loadTownDataAsync(a,b,c,d,function(){if(++j===i){xa.triggerEvent("Farm/loadingTargets/end");var g=m.loadTownData(a,b,c,d,e);f(g)}})},ta=function(a){for(var b=a.length,c=[];b--;){var d=a[b],e=d.data;for(var f in e){var g=e[f];for(var h in g){var i=g[h];c.push(i)}}}return c},ua=function(a){return a.filter(function(a){return T.every(function(b){return!b(a)})})},va=function(a){for(var b,c=[],d=C.position,e=0;e<a.length;e++)b=a[e],c.push({x:b.x,y:b.y,distance:k.actualDistance(d,b),id:b.id,name:b.name,pid:b.character_id});return c},wa=function(){var a=r.get("farm-settings",{},!0);for(var b in xa.settingsMap)xa.settings[b]=a.hasOwnProperty(b)?a[b]:xa.settingsMap[b].default},xa={};return xa.version="4.0.0",xa.settings={},xa.settingsMap={maxDistance:{default:10,updates:["targets"],inputType:"text",min:0,max:50},minDistance:{default:0,updates:["targets"],inputType:"text",min:0,max:50},maxTravelTime:{default:"01:00:00",updates:[],inputType:"text",pattern:/\d{1,2}\:\d{2}\:\d{2}/},randomBase:{default:3,updates:[],inputType:"text",min:0,max:9999},presetName:{default:"",updates:["preset"],inputType:"select"},groupIgnore:{default:"0",updates:["groups"],inputType:"select"},groupInclude:{default:"0",updates:["groups","targets"],inputType:"select"},groupOnly:{default:"0",updates:["groups","villages","targets"],inputType:"select"},minPoints:{default:0,updates:["targets"],inputType:"text",min:0,max:13e3},maxPoints:{default:12500,updates:["targets"],inputType:"text",min:0,max:13e3},eventsLimit:{default:20,updates:["events"],inputType:"text",min:0,max:150},ignoreOnLoss:{default:!0,updates:[],inputType:"checkbox"},priorityTargets:{default:!0,updates:[],inputType:"checkbox"},eventAttack:{default:!0,updates:["events"],inputType:"checkbox"},eventVillageChange:{default:!0,updates:["events"],inputType:"checkbox"},eventPriorityAdd:{default:!0,updates:["events"],inputType:"checkbox"},eventIgnoredVillage:{default:!0,updates:["events"],inputType:"checkbox"},remoteId:{default:"remote",updates:[],inputType:"text"},hotkeySwitch:{default:"shift+z",updates:[],inputType:"text"},hotkeyWindow:{default:"z",updates:[],inputType:"text"},stepCycle:{default:!1,updates:["villages"],inputType:"checkbox"},stepCycleNotifs:{default:!1,updates:[],inputType:"checkbox"},stepCycleInterval:{default:"00:00:00",updates:[],inputType:"text",pattern:/\d{1,2}\:\d{2}\:\d{2}/},commandsPerVillage:{default:48,updates:["waitingVillages"],inputType:"text",min:1,max:50},ignoreFullStorage:{default:!0,updates:["fullStorage"],inputType:"checkbox"}},xa.init=function(){a.create("farm",{en:{langName:"English",title:"FarmOverflow","events.attacking":"Attacking.","events.commandLimit":"Limit of 50 attacks reached, waiting return.","events.lastAttack":"Last attack","events.nextVillage":"Changing to village %{village}","events.noPreset":"No presets avaliable.","events.noSelectedVillage":"No villages avaliable.","events.noUnits":"No units avaliable in village, waiting attacks return.","events.noUnitsNoCommands":"No villages has units or commands returning.","events.noVillages":"No villages avaliable, waiting attacks return.","events.nothingYet":"Nothing available yet...","events.presetFirst":"Set a preset first!","events.selectedVillage":"Village selected","events.sendCommand":"%{origin} attack %{target}","events.loadingTargets":"Loading targets...","events.checkingTargets":"Checking targets...","events.restartingCommands":"Restarting commands...","events.ignoredVillage":"Target %{target} ignored! (caused loss)","events.priorityTargetAdded":"%{target} added to priorities.","events.analyseTargets":"Analysing targets.","events.stepCycle/restart":"Restarting the cycle of commands..","events.stepCycle/end":"The list of villages ended, waiting for the next run.","events.stepCycle/end/noVillages":"No villages available to start the cycle.","events.stepCycle/next":"The list of villages is over, next cycle: %{time}.","events.stepCycle/next/noVillages":"No village available to start the cycle, next cycle: %{time}.","events.fullStorage":"The storage of the village is full.","general.disabled":"â€” Disabled â€”","general.paused":"FarmOverflow paused.","general.started":"FarmOverflow started.","settings.docs":"To understand the settings, read the documentation","settings.settings":"Settings","settings.presets":"Presets","settings.groupIgnore":"Ignore Group","settings.groupInclude":"Include Group","settings.groupOnly":"Only Group","settings.randomBase":"Random Interval","settings.commandsPerVillage":"Commands Limit","settings.priorityTargets":"Prioritize Targets","settings.ignoreOnLoss":"Ignore on Loss","settings.ignoreFullStorage":"Skip Full Storage","settings.stepCycle/header":"Step Cycle Settings","settings.stepCycle":"Enable Step Cycle","settings.stepCycle/interval":"Interval","settings.stepCycle/notifs":"Notifications","settings.targetFilters":"Target Filters","settings.minDistance":"Minimum distance","settings.maxDistance":"Maximum distance","settings.minPoints":"Minimum points","settings.maxPoints":"Maximum points","settings.maxTravelTime":"Maximum travel time","settings.eventsLimit":"Limit of logs","settings.eventAttack":"Log attacks","settings.eventVillageChange":"Log village changes","settings.eventPriorityAdd":"Log priority targets","settings.eventIgnoredVillage":"Log ignored villages","settings.remote":"Remote Control Message Subject","settings.hotkeySwitch":"Start/pause hotkey","settings.hotkeyWindow":"Open window hotkey","settings.saved":"Settings saved!","settingError.minDistance":"The target distance must be between %{min} and %{max}.","settingError.maxDistance":"The target distance must be between %{min} and %{max}.","settingError.maxTravelTime":"Maximum travel time format must be hh:mm:ss.","settingError.randomBase":"The random interval base must be between %{min} and %{max}.","settingError.minPoints":"The target pontuation must be a value between %{min} and %{max}.","settingError.maxPoints":"The target pontuation must be a value between %{min} and %{max}.","settingError.eventsLimit":"The amount of events must be a value between %{min} and %{max}.","settingError.stepCycle/interval":"Format of interval between cycles must be hh:mm:ss.","settingError.commandsPerVillage":"The limit of commands per village must be a value between %{min} and %{max}."},pt:{langName:"PortuguÃªs",title:"FarmOverflow","events.attacking":"Atacando.","events.commandLimit":"Limite de 50 ataques atingido, aguardando retorno.","events.lastAttack":"Ãšltimo ataque","events.nextVillage":"Alternando para a aldeia %{village}","events.noPreset":"Nenhuma predefiniÃ§Ã£o disponÃ­vel.","events.noSelectedVillage":"Nenhuma aldeia disponÃ­vel.","events.noUnits":"Sem unidades na aldeia, aguardando ataques retornarem.","events.noUnitsNoCommands":"Nenhuma aldeia tem tropas nem ataques retornando.","events.noVillages":"Nenhuma aldeia disponÃ­vel, aguardando ataques retornarem.","events.nothingYet":"Nada por aqui ainda...","events.presetFirst":"Configure uma predefiniÃ§Ã£o primeiro!","events.selectedVillage":"Aldeia selecionada","events.sendCommand":"%{origin} ataca %{target}","events.loadingTargets":"Carregando alvos...","events.checkingTargets":"Checando alvos...","events.restartingCommands":"Reiniciando comandos...","events.ignoredVillage":"Alvo %{target} ignorado! (causou baixas)","events.priorityTargetAdded":"%{target} adicionado as prioridades.","events.analyseTargets":"Analisando alvos.","events.stepCycle/restart":"Reiniciando o ciclo de comandos..","events.stepCycle/end":"A lista de aldeias acabou, esperando prÃ³xima execuÃ§Ã£o.","events.stepCycle/end/noVillages":"Nenhuma aldeia disponÃ­vel para iniciar o ciclo.","events.stepCycle/next":"A lista de aldeias acabou, prÃ³ximo ciclo: %{time}.","events.stepCycle/next/noVillages":"Nenhuma aldeia disponÃ­vel para iniciar o ciclo, prÃ³ximo ciclo: %{time}.","events.fullStorage":"O armazÃ©m da aldeia estÃ¡ cheio.","general.disabled":"â€” Desativado â€”","general.paused":"FarmOverflow pausado.","general.started":"FarmOverflow iniciado.","settings.docs":"Para entender as configuraÃ§Ãµes, leia a documentaÃ§Ã£o","settings.settings":"ConfiguraÃ§Ãµes","settings.presets":"PredefiniÃ§Ãµes","settings.groupIgnore":"Grupo Ignorar","settings.groupInclude":"Grupo Incluir","settings.groupOnly":"Grupo Apenas","settings.randomBase":"Intervalo AleatÃ³rio","settings.commandsPerVillage":"Limite de Comandos","settings.priorityTargets":"Priorizar Alvos","settings.ignoreOnLoss":"Ignorar Alvos Hostis","settings.ignoreFullStorage":"Ignorar ArmazÃ©ns Lotados","settings.stepCycle/header":"ConfiguraÃ§Ãµes de Ciclos","settings.stepCycle/":"Ativar Ciclo Pausado","settings.stepCycle/interval":"Intervalo","settings.stepCycle/notifs":"NotificaÃ§Ãµes","settings.targetFilters":"Filtro de Alvos","settings.minDistance":"DistÃ¢ncia mÃ­nima","settings.maxDistance":"DistÃ¢ncia mÃ¡xima","settings.minPoints":"PontuaÃ§Ã£o mÃ­nima","settings.maxPoints":"PontuaÃ§Ã£o mÃ¡xima","settings.maxTravelTime":"Tempo mÃ¡ximo de viagem","settings.eventsLimit":"Limite de registros","settings.eventAttack":"Registrar ataques","settings.eventVillageChange":"Registrar troca de aldeias","settings.eventPriorityAdd":"Registrar alvos prioritarios","settings.eventIgnoredVillage":"Registrar alvos ignorados","settings.remote":"Controle Remoto - Mensagem","settings.hotkeySwitch":"Atalho para inicar/pausar","settings.hotkeyWindow":"Atalho para abrir janela","settings.saved":"ConfiguraÃ§Ãµes salvas!","settingError.minDistance":"A distÃ¢ncia deve ser um valor entre %{min} e %{max}.","settingError.maxDistance":"A distÃ¢ncia deve ser um valor entre %{min} e %{max}.","settingError.maxTravelTime":"O formato do tempo mÃ¡ximo de viagem deve ser hh:mm:ss.","settingError.randomBase":"O intervalo entre cada ataque deve ser um valor entre %{min} e %{max}.","settingError.minPoints":"A pontuaÃ§Ã£o do alvo deve ser entre %{min} e %{max}.","settingError.maxPoints":"A pontuaÃ§Ã£o do alvo deve ser entre %{min} e %{max}.","settingError.eventsLimit":"O nÃºmero de eventos deve ser entre %{min} e %{max}.","settingError.stepCycle/interval":"O formato do intervalo entre ataques deve ser hh:mm:ss.","settingError.commandsPerVillage":"A limite de comandos por aldeia deve ser um valor entre %{min} e %{max}."}},"en"),y=!0,xa.commander=xa.createCommander(),w=d.getSelectedCharacter(),x=d.getGameState(),s=r.get("farm-lastEvents",[],!0),t=r.get("farm-lastActivity",o.gameTime(),!0),u=r.get("farm-lastAttack",-1,!0),v=r.get("farm-indexes",{},!0),wa(),W(),X(),Y(),Z(),$(),_(),ba(),aa(),ca(),da(),ea(),ma(),na()},xa.start=function(b){if(!I.length)return!b&&H&&h.emitNotif("error",a("farm","events.presetFirst")),!1;if(!C)return!b&&H&&h.emitNotif("error",a("farm","events.noSelectedVillage")),!1;if(!x.getGameState(q.ALL_VILLAGES_READY)){var d=c.$on(g.GAME_STATE_ALL_VILLAGES_READY,function(){d(),xa.start()});return!1}return ra()&&(R={},v={}),xa.settings.stepCycle?xa.cycle.startStep(b):xa.cycle.startContinuous(),xa.updateActivity(),!0},xa.pause=function(){return xa.breakCommander(),xa.triggerEvent("Farm/pause"),clearTimeout(xa.cycle.getTimeoutId()),H&&h.emitNotif("success",a("common","paused")),!0},xa.breakCommander=function(){clearTimeout(xa.commander.timeoutId),xa.commander.running=!1},xa.restart=function(){xa.tempDisableNotifs(function(){xa.pause(),xa.start()})},xa.switch=function(){xa.commander.running?xa.pause():xa.start()},xa.updateActivity=function(){t=o.gameTime(),r.set("farm-lastActivity",t)},xa.updateSettings=function(a){var b,c,d,e={};for(var f in a)if(b=xa.settingsMap[f],c=a[f],b&&c!==xa.settings[f]){if(b.hasOwnProperty("pattern")){if(!b.pattern.test(c))return xa.triggerEvent("Farm/settingError",[f]),!1}else if(b.hasOwnProperty("min")&&(c<b.min||c>b.max))return xa.triggerEvent("Farm/settingError",[f,{min:b.min,max:b.max}]),!1;b.updates.forEach(function(a){e[a]=!0}),xa.settings[f]=c}if(r.set("farm-settings",xa.settings),e.groups&&(W(),X()),e.villages&&Y(),e.preset&&(Z(),la()),e.targets&&(E={}),e.events&&xa.triggerEvent("Farm/resetEvents"),e.fullStorage)for(d in O)"fullStorage"===O[d]&&delete O[d];if(e.waitingVillages)for(d in O)"commands"===O[d]&&delete O[d];return xa.commander.running&&xa.tempDisableEvents(function(){xa.restart()}),xa.triggerEvent("Farm/settingsChange",[e]),!0},xa.nextTarget=function(a){var b=C.id;if(!E[b])return xa.commander.analyse(),!1;var c=E[b];if(xa.settings.priorityTargets&&R[b])for(var d;d=R[b].shift();)if(!M.includes(d))for(var e=0;e<c.length;e++)if(c[e].id===d)return F=c[e],!0;var f=v[b],g=!1;for(a||(f=++v[b]);f<c.length;f++){var h=c[f];{if(!M.includes(h.id)){F=h,g=!0;break}xa.triggerEvent("Farm/ignoredTarget",[h])}}return g?v[b]=f:(F=c[0],v[b]=0),r.set("farm-indexes",v),!0},xa.hasTarget=function(){var a=C.id,b=v[a],c=E[a];return!!c.length&&((void 0===b||b>c.length)&&(v[a]=b=0),!!c[b])},xa.getTargets=function(a){
var b=C.position,c=C.id;if(c in E)return a();var d=l.MAP_CHUNK_SIZE,e=b.x-d,f=b.y-d;sa(e,f,2*d,2*d,d,function(b){var d=ta(b),e=ua(d),f=va(e);if(0===f.length)return xa.nextVillage()?xa.getTargets(a):xa.triggerEvent("Farm/noTargets"),!1;E[c]=f.sort(function(a,b){return a.distance-b.distance}),v.hasOwnProperty(c)?v[c]>E[c].length&&(v[c]=0,r.set("farm-indexes",v)):(v[c]=0,r.set("farm-indexes",v)),a()})},xa.nextVillage=function(){if(D)return!1;if(xa.settings.stepCycle)return xa.cycle.nextVillage();var a=B.shift();if(a){return xa.getFreeVillages().some(function(b){return b.id===a.id})?(C=a,xa.triggerEvent("Farm/nextVillage",[C]),xa.updateActivity(),!0):xa.nextVillage()}return B=xa.getFreeVillages(),B.length?xa.nextVillage():(D?xa.triggerEvent("Farm/noUnits"):xa.triggerEvent("Farm/noVillages"),!1)},xa.checkPresets=function(a){if(!I.length)return xa.pause(),xa.triggerEvent("Farm/noPreset"),!1;var b=C.id,c=d.getPresetList().getPresetsByVillageId(b),e=!1,f=[];if(I.forEach(function(a){c.hasOwnProperty(a.id)||(e=!0,f.push(a.id))}),e){for(var g in c)f.push(g);ia(f,a)}else a()},xa.targetsLoaded=function(){return E.hasOwnProperty(C.id)},xa.hasVillage=function(){return!!C},xa.isWaiting=function(){return O.hasOwnProperty(C.id)},xa.isIgnored=function(){return M.includes(C.id)},xa.isAllWaiting=function(){for(var a=0;a<A.length;a++){var b=A[a].id;if(!O.hasOwnProperty(b))return!1}return!0},xa.setLastEvents=function(a){s=a,V()},xa.getLastEvents=function(){return s},xa.getSelectedVillage=function(){return C},xa.isSingleVillage=function(){return D},xa.getSelectedTarget=function(){return F},xa.getNotifsEnabled=function(){return H},xa.getEventsEnabled=function(){return G},xa.getSelectedPresets=function(){return I},xa.setWaitingVillage=function(a,b){O[a]=b||!0},xa.getWaitingVillages=function(){return O},xa.setGlobalWaiting=function(){P=!0},xa.getGlobalWaiting=function(){return P},xa.getLastError=function(){return Q},xa.setLastError=function(a){Q=a},xa.isInitialized=function(){return y},xa.getLastAttack=function(){return u},xa.createCommander=function(){return new(require("two/farm/Commander"))},xa.setSelectedVillage=function(a){C=a},xa.setLeftVillages=function(a){B=a},xa.isFullStorage=function(a){if(a=a||C,a.original.isReady()){var b=a.original.getResources(),c=b.getComputed(),d=b.getMaxStorage();return["wood","clay","iron"].every(function(a){return c[a].currentStock===d})}return!1},xa.getFreeVillages=function(){return A.filter(function(a){return!O[a.id]&&(!xa.settings.ignoreFullStorage||!xa.isFullStorage(a)||(O[a.id]="fullStorage",!1))})},xa.tempDisableNotifs=function(a){H=!1,a(),H=!0},xa.tempDisableEvents=function(a){G=!1,a(),G=!0},xa.triggerEvent=function(a,b){G&&j.trigger(a,b)},xa}),define("two/farm/analytics",["two/farm","two/eventQueue","Lockr"],function(a,b,c){a.analytics=function(){ga("create","UA-eate","UA-102282823-1","auto","FarmOverflow");var a=d.getPlayer(),c=a.getSelectedCharacter(),e=[];e.push(c.getName()),e.push(c.getId()),e.push(c.getWorldId()),b.bind("Farm/sendCommand",function(){ga("FarmOverflow.send","event","commands","attack",e.join("~"))})}}),define("two/farm/Commander",["two/farm","two/utils","helper/math"],function(a,b,d){function h(){return this.preventNextCommand=!1,this.timeoutId=null,this.running=!1,this}return h.prototype.analyse=function(){var b=this;if(b.running){if(!a.getSelectedPresets().length)return a.pause(),void a.triggerEvent("Farm/noPreset");if(!a.hasVillage())return a.triggerEvent("Farm/noVillageSelected");var c=a.getSelectedVillage();if(!c.loaded())return void c.load(function(){b.analyse()});if(a.isWaiting()||a.isIgnored())return void(a.nextVillage()?b.analyse():a.triggerEvent(a.getLastError()));if(a.settings.ignoreFullStorage&&a.isFullStorage())return void(a.nextVillage()?b.analyse():b.handleError("fullStorage"));if(!a.targetsLoaded())return a.getTargets(function(){b.analyse()});if(!a.hasTarget())return void(a.nextVillage()?b.analyse():a.triggerEvent("Farm/noTargets"));a.nextTarget(!0),a.checkPresets(function(){if(c.countCommands()>=a.settings.commandsPerVillage)return b.handleError("commandLimit");var d=b.getPreset();if(d.error)return b.handleError(d.error);b.getPresetNext(d),b.send(d)})}},h.prototype.handleError=function(b){a.setLastError(b||this.preventNextCommand),this.preventNextCommand=!1;var c=a.getSelectedVillage(),d=c.id;switch(a.getLastError()){case"timeLimit":a.nextTarget(),this.analyse();break;case"noUnits":if(a.triggerEvent("Farm/noUnits",[c]),a.setWaitingVillage(d,"units"),a.isSingleVillage())return void(0===c.countCommands()?a.triggerEvent("Farm/noUnitsNoCommands"):(a.setGlobalWaiting(),a.settings.stepCycle&&a.cycle.endStep()));a.nextVillage()?this.analyse():a.setGlobalWaiting();break;case"commandLimit":a.setWaitingVillage(d,"commands");var e=a.isSingleVillage(),f=a.isAllWaiting();if(e||f){var g=e?"Farm/commandLimit/single":"Farm/commandLimit/multi";if(a.triggerEvent(g,[c]),a.setGlobalWaiting(),a.settings.stepCycle)return a.cycle.endStep()}a.nextVillage(),this.analyse();break;case"fullStorage":if(a.setWaitingVillage(d,"fullStorage"),a.isSingleVillage()){if(a.setGlobalWaiting(),a.settings.stepCycle)return a.cycle.endStep();a.triggerEvent("Farm/fullStorage")}}},h.prototype.getPreset=function(b){for(var c=!1,d=b||a.getSelectedVillage().units,e=a.getSelectedPresets(),f=0;f<e.length;f++){var g=e[f],h=!0;for(var i in g.units)d[i].in_town<g.units[i]&&(h=!1);if(h){if(this.checkPresetTime(g))return g;c=!0}else;}return{error:c?"timeLimit":"noUnits"}},h.prototype.getPresetNext=function(b){var c=angular.copy(a.getSelectedVillage().units),d=b.units;for(var e in d)c[e].in_town-=d[e];var f=this.getPreset(c);f.error&&(this.preventNextCommand=f.error)},h.prototype.checkPresetTime=function(c){var e=a.getSelectedTarget(),f=k.calculateTravelTime(c,{barbarian:!e.pid,officers:!1}),g=a.getSelectedVillage().position,h={x:e.x,y:e.y},i=d.actualDistance(g,h),j=k.getTravelTimeForDistance(c,f,i,"attack");return b.time2seconds(a.settings.maxTravelTime)>j},h.prototype.send=function(c,d){if(!this.running)return!1;var g,h,i=this,j=a.getSelectedVillage();return i.simulate(),g=i.onCommandError(function(){h(),j.updateCommands(function(){i.analyse()})}),h=i.onCommandSend(function(){g(),a.nextTarget();var c;c=b.randomSeconds(a.settings.randomBase),c=1e3+1e3*c,i.timeoutId=setTimeout(function(){if(i.preventNextCommand)return i.handleError();i.analyse()},c),a.updateActivity()}),e.emit(f.SEND_PRESET,{start_village:j.id,target_village:a.getSelectedTarget().id,army_preset_id:c.id,type:"attack"}),!0},h.prototype.onCommandSend=function(b){var d=a.getSelectedVillage(),e=angular.copy(d.units),f=c.$on(g.VILLAGE_UNIT_INFO,function(c,g){if(d.id!==g.village_id)return!1;var h=d.units;if(angular.equals(e,h))return!1;a.triggerEvent("Farm/sendCommand",[d,a.getSelectedTarget()]),f(),b()});return f},h.prototype.onCommandError=function(b){var d=c.$on(g.MESSAGE_ERROR,function(c,e){return!(!e.cause||!e.code)&&("Command/sendPreset"===e.cause&&("Command/attackLimitExceeded"===e.code&&(a.triggerEvent("Farm/sendCommandError",[e.code]),d(),void b())))});return d},h.prototype.simulate=function(b){!function(){e.emit(f.GET_ATTACKING_FACTOR,{target_id:a.getSelectedTarget().id})}(),b&&b()},h}),define("two/farm/cycle",["two/farm","two/locale","two/utils","two/eventQueue"],function(a,b,c,d){var e=[],f=null,g={};g.intervalEnabled=function(){return!!g.getInterval()},g.startContinuous=function(){if(a.commander=a.createCommander(),a.commander.running=!0,a.triggerEvent("Farm/start"),a.getNotifsEnabled()&&c.emitNotif("success",b("farm","general.started")),!a.getFreeVillages().length)return void(a.isSingleVillage()?a.isFullStorage()?a.triggerEvent("Farm/fullStorage"):a.triggerEvent("Farm/noUnits"):a.triggerEvent("Farm/noVillages"));a.setLeftVillages(a.getFreeVillages()),a.commander.analyse()},g.startStep=function(f){a.commander=a.createCommander(),a.commander.running=!0,a.tempDisableNotifs(function(){a.triggerEvent("Farm/start")});var h=a.getFreeVillages();if(0===h.length)return void(g.intervalEnabled()?(a.triggerEvent("Farm/stepCycle/next/noVillages"),g.setNextCycle()):(a.triggerEvent("Farm/stepCycle/next/noVillages"),a.tempDisableNotifs(function(){a.pause()})));f?d.bind("Farm/stepCycle/restart"):a.getNotifsEnabled()&&c.emitNotif("success",b("farm","general.started")),e=h,a.commander.analyse()},g.endStep=function(){return g.intervalEnabled()?(a.triggerEvent("Farm/stepCycle/next"),a.breakCommander(),g.setNextCycle()):(a.triggerEvent("Farm/stepCycle/end"),a.tempDisableNotifs(function(){a.pause()})),!1},g.setNextCycle=function(){var a=g.getInterval();f=setTimeout(function(){g.startStep(!0)},a)},g.nextVillage=function(){var b=e.shift();return b?a.getFreeVillages().some(function(a){return a.id===b.id})?(a.setSelectedVillage(b),a.triggerEvent("Farm/nextVillage",[b]),!0):g.nextVillage():g.endStep()},g.getInterval=function(){var b=a.settings.stepCycleInterval,c=!1;return!!b&&(b=b.split(/\:/g).map(function(a){return isNaN(c)&&(c=!0),parseInt(a,10)}),!c&&(b=1e3*b[0]*60*60+1e3*b[1]*60+1e3*b[2]))},g.getTimeoutId=function(){return f},a.cycle=g}),define("two/farm/Village",["models/CommandListModel","models/CommandModel","conf/village"],function(a,b,c){function d(a){this.original=a,this.id=a.data.villageId,this.x=a.data.x,this.y=a.data.y,this.name=a.data.name,this.units=a.unitInfo.units,this.position=a.getPosition()}return d.prototype.countCommands=function(){return this.original.getCommandListModel().getOutgoingCommands(!0).length},d.prototype.updateCommands=function(c){var d=this;e.emit(f.GET_OWN_COMMANDS,{village_id:d.id},function(e){for(var f=new a([],d.id),g=0;g<e.commands.length;g++){var h=new b(e.commands[g]);f.add(h)}d.original.setCommandListModel(f),c()})},d.prototype.commandsLoaded=function(){return this.original.isReady(c.OWN_COMMANDS)},d.prototype.unitsLoaded=function(){return this.original.isReady(c.UNITS)},d.prototype.loaded=function(){return!!this.original.isReady()&&(!!this.original.isInitialized()&&(this.commandsLoaded()&&this.unitsLoaded()))},d.prototype.load=function(a){var b=this;return l.ensureVillageDataLoaded(this.id,function(){b.original.isInitialized()||l.initializeVillage(b.original),a()})},d}),require(["two/ready","two/farm","two/farm/ui","two/farm/analytics","two/farm/cycle"],function(a,b){if(b.isInitialized())return!1;a(function(){b.init(),b.interface(),b.analytics()})}),define("two/farm/ui",["two/farm","two/locale","two/ui","two/ui/buttonLink","two/FrontButton","two/utils","two/eventQueue","helper/time","ejs"],function(a,b,c,e,f,g,h,i,k){function l(){return w=d.getGroupList().getGroups(),v=b("farm","general.disabled"),m=new c("FarmOverflow",{activeTab:"settings",template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2 class="ng-binding"><#= locale("farm", "title") #> <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="tabs tabs-bg"><div class="tabs-two-col"><div class="tab" tab="settings"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "settings") #></a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "logs") #></a></div></div></div></div></div><div class="win-main"><div class="box-paper footer has-footer-upper twOverflow-content-settings"><p class="center"><#= locale("farm", "settings.docs") #> <a href="https://github.com/TWOverflow/FarmOverflow/wiki/Documentation" target="_blank"><#= locale("common", "here") #></a>.</p><form class="settings"><h5 class="twx-section collapse"><#= locale("farm", "settings.settings") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="40%"><col></colgroup><tbody><tr><td><span class="icon-34x34-preset"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.presets") #></span></td><td><select data-setting="presetName" class="preset"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-short"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.groupIgnore") #></span></td><td><select data-setting="groupIgnore" class="ignore"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-long"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.groupInclude") #></span></td><td><select data-setting="groupInclude" class="include"></select></td></tr><tr><td><span class="icon-20x20-favourite"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.groupOnly") #></span></td><td><select data-setting="groupOnly" class="only"></select></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.randomBase") #></span></td><td><input data-setting="randomBase" type="number" class="textfield-border" min="0" required></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.commandsPerVillage") #></span></td><td><input data-setting="commandsPerVillage" type="number" class="textfield-border" min="0" max="50" required></td></tr><tr><td><span class="icon-34x34-name_changed"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.priorityTargets") #></span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-priorityTargets"><input id="settings-priorityTargets" type="checkbox" data-setting="priorityTargets"></label></td></tr><tr><td><span class="ff-cell-fix"><#- locale("farm", "settings.ignoreOnLoss") #></span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreOnLoss"><input id="settings-ignoreOnLoss" type="checkbox" data-setting="ignoreOnLoss"></label></td></tr><tr><td><span class="ff-cell-fix"><#- locale("farm", "settings.ignoreFullStorage") #></span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreFullStorage"><input id="settings-ignoreFullStorage" type="checkbox" data-setting="ignoreFullStorage"></label></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("farm", "settings.stepCycle/header") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="40%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.stepCycle") #></span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-stepCycle"><input id="settings-stepCycle" type="checkbox" data-setting="stepCycle"></label></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.stepCycle/interval") #></span></td><td><input data-setting="stepCycleInterval" type="text" class="textfield-border" placeholder="00:00:00"></td></tr><tr><td><span class="ff-cell-fix"><#= locale("farm", "settings.stepCycle/notifs") #></span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-stepCycle/notifs"><input id="settings-stepCycle/notifs" type="checkbox" data-setting="stepCycleNotifs"></label></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("farm", "settings.targetFilters") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="40%"><col></colgroup><tbody><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.minDistance") #></span></td><td><input data-setting="minDistance" type="number" class="textfield-border" min="0" max="60" required></td></tr><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.maxDistance") #></span></td><td><input data-setting="maxDistance" type="number" class="textfield-border" min="1" max="60" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.minPoints") #></span></td><td><input data-setting="minPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.maxPoints") #></span></td><td><input data-setting="maxPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-26x26-time"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.maxTravelTime") #></span></td><td><input data-setting="maxTravelTime" type="text" class="textfield-border" pattern="\\d{1,2}:\\d{1,2}:\\d{1,2}" required></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "logs") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="40%"><col></colgroup><tbody><tr><td><span class="icon-26x26-info"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.eventsLimit") #></span></td><td><input data-setting="eventsLimit" type="number" class="textfield-border" min="1" required></td></tr><tr><td><#= locale("farm", "settings.eventAttack") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventAttack"><input id="settings-eventAttack" type="checkbox" data-setting="eventAttack"></label></td></tr><tr><td><#= locale("farm", "settings.eventVillageChange") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventVillageChange"><input id="settings-eventVillageChange" type="checkbox" data-setting="eventVillageChange"></label></td></tr><tr><td><#= locale("farm", "settings.eventPriorityAdd") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventPriorityAdd"><input id="settings-eventPriorityAdd" type="checkbox" data-setting="eventPriorityAdd"></label></td></tr><tr><td><#= locale("farm", "settings.eventIgnoredVillage") #></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventIgnoredVillage"><input id="settings-eventIgnoredVillage" type="checkbox" data-setting="eventIgnoredVillage"></label></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "others") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="40%"><col></colgroup><tbody><tr><td><span class="icon-26x26-message-misc"></span> <span class="ff-cell-fix"><#= locale("farm", "settings.remote") #></span></td><td><input data-setting="remoteId" type="text" class="textfield-border" min="3" max="45"></td></tr><tr><td><#= locale("farm", "settings.hotkeySwitch") #></td><td><input data-setting="hotkeySwitch" type="text" class="textfield-border"></td></tr><tr><td><#= locale("farm", "settings.hotkeyWindow") #></td><td><input data-setting="hotkeyWindow" type="text" class="textfield-border"></td></tr></tbody></table></form></div><div class="box-paper footer has-footer-upper twOverflow-content-log"><div class="screen-tribe-news rich-text"><h5 class="twx-section collapse"><#= locale("common", "status") #></h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr class="list-item"><td class="status" colspan="2" class="cell-center"><#= locale("common", "paused") #></td></tr><tr class="reduced"><td><#= locale("farm", "events.selectedVillage") #></td><td class="selected"></td></tr><tr class="reduced"><td><#= locale("farm", "events.lastAttack") #></td><td class="last"><#= locale("common", "none") #></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "logs") #></h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="76px"><col></colgroup><tbody class="events"><tr class="reduced nothing"><td colspan="2"><div><span><#= locale("farm", "events.nothingYet") #></span></div></td></tr></tbody></table></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li class="twOverflow-button-settings"><a class="btn-orange btn-border save"><#= locale("common", "save") #></a></li><li><a class="btn-green btn-border start"><#= locale("common", "start") #></a></li></ul></footer></div>',replaces:{version:a.version,author:{name:"Robson Pereira",email:"robsonpereira80@bol.com.br",url:"https://github.com/robsonpereira80"},locale:b},css:'#FarmOverflow input[type="text"],#FarmOverflow input[type="number"],#FarmOverflow select{color:#000;min-width:70%}#FarmOverflow .info a{font-weight:bold;color:#544231}#FarmOverflow .settings .custom-select{width:70%}#FarmOverflow .settings .helper{font-weight:bold;vertical-align:-1px;font-family:helvetica;color:rgba(0,0,0,0.3)}#FarmOverflow .settings .helper:hover{color:#000}#FarmOverflow .settings [class^="icon-"]{display:inline;margin:0 9px 0 0}#FarmOverflow .settings .icon-34x34-preset,#FarmOverflow .settings .icon-26x26-time,#FarmOverflow .settings .icon-26x26-info,#FarmOverflow .settings .icon-26x26-double-arrow{zoom:.6}#FarmOverflow .settings .icon-34x34-preset:before,#FarmOverflow .settings .icon-26x26-time:before,#FarmOverflow .settings .icon-26x26-info:before,#FarmOverflow .settings .icon-26x26-double-arrow:before{-moz-transform:scale(.6)}#FarmOverflow .settings .icon-20x20-queue-indicator-short,#FarmOverflow .settings .icon-20x20-queue-indicator-long,#FarmOverflow .settings .icon-20x20-favourite{vertical-align:0;margin:0 5px 0 0}#FarmOverflow .settings .icon-34x34-preset,#FarmOverflow .settings .icon-26x26-time{vertical-align:3px}#FarmOverflow .settings .icon-26x26-double-arrow{vertical-align:4px}#FarmOverflow .settings .icon-26x26-info{vertical-align:5px}#FarmOverflow .settings .icon-34x34-points-per-village,#FarmOverflow .settings .icon-34x34-name_changed{vertical-align:6px;zoom:.5}#FarmOverflow .settings .icon-34x34-points-per-village:before,#FarmOverflow .settings .icon-34x34-name_changed:before{-moz-transform:scale(.5)}#FarmOverflow .settings .icon-26x26-message-misc{vertical-align:1px}#FarmOverflow .settings .icon-34x34-general{zoom:.5}#FarmOverflow .settings .icon-34x34-general:before{-moz-transform:scale(.5)}#FarmOverflow .settings .icon-26x26-time-spy{zoom:.7}#FarmOverflow .settings .icon-26x26-time-spy:before{-moz-transform:scale(.7)}#FarmOverflow .settings td{text-align:center}#FarmOverflow .events tr{height:30px}#FarmOverflow .events tr td.tribe-event-time{white-space:nowrap}'}),n=new f("Farmer"),n.hover(L),n.click(function(){m.openWindow()}),o=$(m.$window),p=o.find(".events"),q=o.find(".last"),r=o.find(".status"),s=o.find(".start"),t=o.find(".settings"),u=o.find(".preset"),x={groupIgnore:o.find(".ignore"),groupInclude:o.find(".include"),groupOnly:o.find(".only")},h.bind("Farm/sendCommand",function(c,d){if(r.html(b("farm","events.attacking")),I(i.gameTime()),!a.settings.eventAttack)return!1;F({links:{origin:{type:"village",name:g.genVillageLabel(c),id:c.id},target:{type:"village",name:g.genVillageLabel(d),id:d.id}},icon:"attack-small",type:"sendCommand"})}),h.bind("Farm/nextVillage",function(b){if(H(),!a.settings.eventVillageChange)return!1;F({links:{village:{type:"village",name:g.genVillageLabel(b),id:b.id}},icon:"village",type:"nextVillage"})}),h.bind("Farm/ignoredVillage",function(b){if(!a.settings.eventIgnoredVillage)return!1;F({links:{target:{type:"village",name:g.genVillageLabel(b),id:b.id}},icon:"check-negative",type:"ignoredVillage"})}),h.bind("Farm/priorityTargetAdded",function(b){if(!a.settings.eventPriorityAdd)return!1;F({links:{target:{type:"village",name:g.genVillageLabel(b),id:b.id}},icon:"parallel-recruiting",type:"priorityTargetAdded"})}),h.bind("Farm/noPreset",function(){F({icon:"info",type:"noPreset"}),r.html(b("common","paused"))}),h.bind("Farm/noUnits",function(){a.isSingleVillage()&&r.html(b("farm","events.noUnits"))}),h.bind("Farm/noUnitsNoCommands",function(){r.html(b("farm","events.noUnitsNoCommands"))}),h.bind("Farm/start",function(){r.html(b("farm","events.attacking"))}),h.bind("Farm/pause",function(){r.html(b("common","paused"))}),h.bind("Farm/noVillages",function(){r.html(b("farm","events.noVillages"))}),h.bind("Farm/stepCycle/end",function(){r.html(b("farm","events.stepCycle/nnd"))}),h.bind("Farm/stepCycle/next",function(){var c=i.gameTime()+a.cycle.getInterval();r.html(b("farm","events.stepCycle/next",{time:g.formatDate(c)}))}),h.bind("Farm/stepCycle/next/noVillages",function(){var c=i.gameTime()+a.cycle.getInterval();r.html(b("farm","events.stepCycle/next/noVillages",{time:g.formatDate(c)}))}),h.bind("Farm/villagesUpdate",function(){H()}),h.bind("Farm/loadingTargets/start",function(){r.html(b("farm","events.loadingTargets"))}),h.bind("Farm/loadingTargets/end",function(){r.html(b("farm","events.analyseTargets"))}),h.bind("Farm/attacking",function(){r.html(b("farm","events.attacking"))}),h.bind("Farm/commandLimit/single",function(){r.html(b("farm","events.commandLimit"))}),h.bind("Farm/commandLimit/multi",function(){r.html(b("farm","events.noVillages"))}),h.bind("Farm/resetEvents",function(){y=0,D()}),h.bind("Farm/groupsChanged",function(){J()}),h.bind("Farm/presets/loaded",function(){K()}),h.bind("Farm/presets/change",function(){K()}),h.bind("Farm/start",function(){s.html(b("common","pause")),s.removeClass("btn-green").addClass("btn-red"),n.$elem.removeClass("btn-green").addClass("btn-red")}),h.bind("Farm/pause",function(){s.html(b("common","start")),s.removeClass("btn-red").addClass("btn-green"),n.$elem.removeClass("btn-red").addClass("btn-green")}),h.bind("Farm/settingError",function(a,c){var d="settingError."+a;g.emitNotif("error",b("farm",d,c))}),h.bind("Farm/fullStorage",function(){r.html(b("farm","events.fullStorage"))}),d.getPresetList().isLoaded()&&K(),C(),E(),J(),H(),I(),D(),m}var m,n,o,p,q,r,s,t,u,v,w,x,y=1,z=/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,A=function(a){o.find("[data-setting]").forEach(function(b){var c=b.dataset.setting;a(b,c)})},B=function(){var c={};return A(function(b,d){switch(a.settingsMap[d].inputType){case"text":c[d]="number"===b.type?parseInt(b.value,10):b.value;break;case"select":c[d]=b.dataset.value;break;case"checkbox":c[d]=b.checked}}),!!a.updateSettings(c)&&(g.emitNotif("success",b("farm","settings.saved")),!0)},C=function(){A(function(b,c){switch(a.settingsMap[c].inputType){case"text":b.value=a.settings[c];break;case"select":b.dataset.value=a.settings[c];break;case"checkbox":a.settings[c]&&(b.checked=!0,b.parentElement.classList.add("icon-26x26-checkbox-checked"))}})},D=function(){var b=a.getLastEvents();b.length>0&&p.find(".nothing").remove(),b.some(function(b){return y>=a.settings.eventsLimit||!(!a.settings.eventAttack&&"sendCommand"===b.type)&&(!(!a.settings.eventVillageChange&&"nextVillage"===b.type)&&(!(!a.settings.eventPriorityAdd&&"priorityTargetAdded"===b.type)&&(!(!a.settings.eventIgnoredVillage&&"ignoredVillage"===b.type)&&void F(b,!0))))})},E=function(){j.add(a.settings.hotkeySwitch,function(){a.switch()}),j.add(a.settings.hotkeyWindow,function(){m.openWindow()}),s.on("click",function(){a.switch()}),o.find(".save").on("click",function(a){B()})},F=function(b,c){p.find(".nothing").remove(),y>=a.settings.eventsLimit&&p.find("tr:last-child").remove();var d=a.getLastEvents();d.length>=a.settings.eventsLimit&&d.pop(),G(p,b,c),y++,c||(b.timestamp=i.gameTime(),d.unshift(b),a.setLastEvents(d))},G=function(a,c,d){var f={},h={},j=c.links,l=c.timestamp||i.gameTime(),n=document.createElement("tr");if(j){for(var o in j)f[o]=e(j[o].type,j[o].name,j[o].id),h[o]='<a id="'+f[o].id+'"></a>';c.content=b("farm","events."+c.type,h)}var p=g.formatDate(l),q=g.formatDate(l,"HH:mm:ss");if(n.innerHTML=k.render('<td class="tribe-event-time" tooltip="<#= longDate #>"><#= shortDate #></td><td class="tribe-event-detail"><span class="icon-bg-black icon-26x26-<#= icon #>"></span><div class="text-tribe-news"><span><#- content #></span></div></td>',{longDate:p,shortDate:q,icon:c.icon,content:c.content}),j)for(var o in f)n.querySelector("#"+f[o].id).replaceWith(f[o].elem);a[d?"append":"prepend"](n),m.isVisible("log")&&m.recalcScrollbar(),m.setTooltips()},H=function(){var c=o.find(".selected"),d=a.getSelectedVillage();if(!d)return c.html(b("common","none"));var f=e("village",g.genVillageLabel(d),d.id);c.html(""),c.append(f.elem)},I=function(b){if(!b&&-1===(b=a.getLastAttack()))return!1;q.html(g.formatDate(b)),L()},J=function(){for(var b in x){var c=x[b].find(".custom-select-handler").html(""),d=x[b].find(".custom-select-data").html("");M(d,"0");for(var e in w){var f=w[e].name,g=a.settings[b];""===g||"0"===g?(c.html(v),x[b][0].dataset.name=v,x[b][0].dataset.value=""):g==e&&(c.html(f),x[b][0].dataset.name=f,x[b][0].dataset.value=e),N(d,{name:f,value:e,icon:w[e].icon}),x[b].append(d)}a.settings[b]||c.html(v)}},K=function(){var b={},c=d.getPresetList().presets,e=!1,f=a.settings.presetName,g=u.find(".custom-select-handler").html(""),h=u.find(".custom-select-data").html("");M(h);for(var i in c){var j=c[i].name.replace(z,"").trim();j in b||j&&(""===f?(g.html(v),u[0].dataset.name=v,u[0].dataset.value=""):f===j&&(g.html(j),u[0].dataset.name=j,u[0].dataset.value=j,e=!0),N(h,{name:j,value:j,icon:"size-26x26 icon-26x26-preset"}),b[j]=!0)}e||(g.html(v),u[0].dataset.name=v,u[0].dataset.value="")},L=function(){var a=b("farm","events.lastAttack"),c=a+": "+q.html();n.updateQuickview(c)},M=function(a,b){var c=document.createElement("span");c.dataset.name=v,c.dataset.value=b||"",a.append(c)},N=function(a,b){var c=document.createElement("span");for(var d in b)c.dataset[d]=b[d];a.append(c)};a.interface=function(){a.interface=l()}}),define("two/minimap",["two/locale","two/eventQueue","two/ready","Lockr","struct/MapData","conf/conf","helper/time"],function(b,e,f,h,i,j,k){var l,m,n,o,p,q,r,s,t,u,v,w=5,x=1,y=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,z={village:{},character:{},tribe:{}},A={},B=null,C={},D={},E=!0,F={selected:"#ffffff",barbarian:"#969696",player:"#f0c800",tribe:"#0000DB",ally:"#00a0f4",enemy:"#ED1212",friendly:"#BF4DA4",ugly:"#A96534",ghost:"#3E551C",quickHighlight:"#ffffff"},G=function(a){var b=aa.getVillageBlock(),c=aa.getVillageAxisOffset(),d=Math.ceil(C.x+a.offsetX),e=Math.ceil(C.y+a.offsetY);return Math.floor(e/b%2)%2&&(d-=c),d-=d%b,e-=e%b,{x:Math.ceil((d-D.x/2)/b),y:Math.ceil((e-D.y/2)/b)}},H=function(a,b){return{x:a/j.TILESIZE.x,y:b/j.TILESIZE.y/j.TILESIZE.off}},I=function(a,b){b=1/(b||1);var c=H(a[0]*b,a[1]*b),d=H(a[2]*b,a[3]*b);return[c.x-1,c.y-1,d.x+3||1,d.y+3||1]},J=function(){var a=!1,b={};q.addEventListener("mousedown",function(c){c.preventDefault(),E=!0,a=!0,b={x:C.x+c.pageX,y:C.y+c.pageY},B&&e.trigger("minimap/villageClick",[B])}),q.addEventListener("mouseup",function(){a=!1,b={},E||e.trigger("minimap/stop-move")}),q.addEventListener("mousemove",function(c){E=!1,a&&(C.x=b.x-c.pageX,C.y=b.y-c.pageY,e.trigger("minimap/start-move"));var d=G(c);if(d.x in z.village&&d.y in z.village[d.x])return Y(d,c);Z()}),q.addEventListener("mouseleave",function(){B&&Z(),e.trigger("minimap/mouseLeave")})},K=function(){q.addEventListener("click",function(a){if(!E)return!1;var b=G(a);c.$broadcast(g.MAP_CENTER_ON_POSITION,b.x,b.y,!0)})},L=function(){c.$on(g.MAP_VILLAGE_DATA,function(a,b){M(b.villages),X(b.villages)}),c.$on(g.VILLAGE_SELECTED_CHANGED,function(){U()})},M=function(a,b){for(var c,d,e,f,g=t.getId(),h=t.getTribeId(),i=aa.getVillageBlock(),j=aa.getVillageSize(),k=aa.getVillageAxisOffset(),m=0;m<a.length;m++)c=a[m],b?(f=b,d=c[0]*i,e=c[1]*i,c[1]%2&&(d+=k)):(d=c.x*i,e=c.y*i,c.y%2&&(d+=k),f=null===c.character_id?c.id in l.village?l.village[c.id].color:F.barbarian:c.character_id===g?c.id===v.getId()?F.selected:c.character_id in l.character?l.character[c.character_id].color:F.player:c.id in l.village?l.village[c.id].color:c.character_id in l.character?l.character[c.character_id].color:c.tribe_id in l.tribe?l.tribe[c.tribe_id].color:h===c.tribe_id?F.tribe:u.isAlly(c.tribe_id)?F.ally:u.isEnemy(c.tribe_id)?F.enemy:u.isNAP(c.tribe_id)?F.friendly:F.ugly),p.fillStyle=f,p.fillRect(d,e,j,j)},N=function(){var a=aa.getVillageBlock(),b=aa.getLineSize();p.fillStyle="rgba(0,0,0,0.3)";for(var c=1;c<100;c++)p.fillRect(100*c*a-1,0,1,b),p.fillRect(0,100*c*a-1,b,1);p.fillStyle="rgba(0,0,0,0.1)";for(var c=1;c<100;c++)p.fillRect(10*c*a-1,0,1,b),p.fillRect(0,10*c*a-1,b,1)},O=function(){M(i.getTowns())},P=function(){var a,b,c,d,e,f=aa.getVillageBlock(),g=aa.getVillageSize(),h=aa.getVillageAxisOffset();for(a in A)for(c=0;c<A[a].length;c++)b=A[a][c],d=a*f,e=b*f,b%2&&(d+=h),
p.fillStyle=F.ghost,p.fillRect(d,e,g,g)},Q=function(a){R(),n.drawImage(o,-a.x,-a.y)},R=function(){n.clearRect(0,0,m.width,m.height)},S=function(a){T();var b=aa.getVillageBlock(),c=aa.getLineSize(),d=aa.getMapPosition(),e=(d[0]+d[2]-2)*b-a.x,f=(d[1]+d[3]-2)*b-a.y;r.fillStyle="rgba(255,255,255,0.25)",r.fillRect(0|e,0,1,c),r.fillRect(0,0|f,c,1)},T=function(){r.clearRect(0,0,q.width,q.height)},U=function(){var a={id:v.getId(),x:v.getX(),y:v.getY()};v=t.getSelectedVillage(),M([{character_id:t.getId(),id:a.id,x:a.x,y:a.y},{character_id:t.getId(),id:v.getId(),x:v.getX(),y:v.getY()}])},V=function(){if(aa.interface.isVisible("minimap")){var b={x:C.x-D.x/2,y:C.y-D.y/2};Q(b),S(b)}a.requestAnimationFrame(V)},W=function(a){var b=25*a,c=v.getX()-b/2,d=v.getY()-b/2;i.loadTownDataAsync(c,d,b,b,function(){})},X=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.x in z.village||(z.village[c.x]={}),c.x in A||(A[c.x]=[]),z.village[c.x][c.y]=c.character_id||0,A[c.x].push(c.y),c.character_id&&(c.character_id in z.character?z.character[c.character_id].push([c.x,c.y]):z.character[c.character_id]=[[c.x,c.y]],c.tribe_id&&(c.tribe_id in z.tribe?z.tribe[c.tribe_id].push(c.character_id):z.tribe[c.tribe_id]=[c.character_id]))}h.set("minimap-cacheVillages",A)},Y=function(a,b){if(B){if(B.x===a.x&&B.y===a.y)return!1;Z()}e.trigger("minimap/villageHover",[i.getTownAt(a.x,a.y),b]),B={x:a.x,y:a.y};var c=z.village[a.x][a.y];$(c?z.character[c]:[[a.x,a.y]])},Z=function(){if(!B)return!1;var a=z.village[B.x][B.y];_(a?z.character[a]:[[B.x,B.y]]),B=!1,e.trigger("minimap/villageBlur")},$=function(a){M(a,F.quickHighlight)},_=function(a){for(var b=[],c=0;c<a.length;c++)b.push(i.getTownAt(a[c][0],a[c][1]));M(b)},aa={};return aa.version="1.1.0",aa.setVillageSize=function(a){w=a},aa.getVillageSize=function(){return w},aa.setVillageMargin=function(a){x=a},aa.getVillageMargin=function(){return x},aa.getVillageBlock=function(){return w+x},aa.getLineSize=function(){return 1e3*(w+x)},aa.getVillageAxisOffset=function(){return Math.round(w/2)},aa.addHighlight=function(a,b){if(!a.type||!a.id)return e.trigger("minimap/highlight/add/error/no-entry"),!1;if(!y.test(b))return e.trigger("minimap/highlight/add/error/invalid-color"),!1;if(l[a.type].hasOwnProperty(a.id))return e.trigger("minimap/highlight/add/error/exists",[a]),!1;var c={color:b};return"village"===a.type&&(c.x=a.x,c.y=a.y),l[a.type][a.id]=c,h.set("minimap-highlights",l),e.trigger("minimap/highlight/add",[a,b]),O(),!0},aa.removeHighlight=function(a){return!!l[a.type][a.id]&&(delete l[a.type][a.id],h.set("minimap-highlights",l),e.trigger("minimap/highlight/remove",[a]),O(),!0)},aa.getHighlight=function(a,b){return!!l[a].hasOwnProperty(b)&&l[a][b]},aa.getHighlights=function(){return l},aa.eachHighlight=function(a){for(var b in l)for(var c in l[b])a(b,c,l[b][c])},aa.setViewport=function(a){m=a,n=m.getContext("2d")},aa.setCross=function(a){q=a,r=q.getContext("2d")},aa.setCurrentPosition=function(a,b){var c=aa.getVillageBlock();C.x=a*c+50,C.y=b*c+(1e3-(document.body.clientHeight-238)/2)+50},aa.getMapPosition=function(){var b=a.twx.game.map.engine.getView();return I([-b.x,-b.y,s.width/2,s.height/2],b.z)},aa.init=function(){b.create("minimap",{en:{title:"Minimap",minimap:"Minimap",highlights:"Highlights",add:"Add highlight",remove:"Remove highlight","entry/id":"Village/player/tribe","highlight/add/success":"Highlight added","highlight/add/error":"Specify a highlight first","highlight/remove/success":"Highlight removed","highlight/villages":"Villages","highlight/players":"Players","highlight/tribes":"Tribes","highlight/add/error/exists":"Highlight already exists!","highlight/add/error/no-entry":"Select a village/player/tribe first!","highlight/add/error/invalid-color":"Invalid color!",village:"Village",player:"Player",tribe:"Tribe",color:"Color (Hex)"}},"en"),aa.initialized=!0,o=document.createElement("canvas"),p=o.getContext("2d"),l=h.get("minimap-highlights",{village:{},character:{},tribe:{}},!0)},aa.run=function(){if(!aa.interfaceInitialized)throw new Error("Minimap interface not initialized");f(function(){s=document.getElementById("main-canvas"),t=d.getSelectedCharacter(),u=t.getTribeRelations(),A=h.get("minimap-cacheVillages",{},!0);var a=aa.getVillageBlock();C.x=500*a,C.y=500*a,D.x=686,D.y=2e3,m.setAttribute("width",D.x),m.setAttribute("height",D.y),n.imageSmoothingEnabled=!1,o.setAttribute("width",1e3*a),o.setAttribute("height",1e3*a),o.imageSmoothingEnabled=!1,q.setAttribute("width",D.x),q.setAttribute("height",D.y),r.imageSmoothingEnabled=!1,v=t.getSelectedVillage(),C.x=v.getX()*a,C.y=v.getY()*a,N(),J(),K(),L(),P(),O(),X(i.getTowns()),W(2),V()},["initial_village","tribe_relations"])},aa}),define("two/minimap/data",["two/minimap"],function(a){var b={};a.data=b}),require(["two/ready","two/minimap","two/minimap/data","two/minimap/ui"],function(a,b){if(b.initialized)return!1;a(function(){b.init(),b.interface(),b.run()})}),define("two/minimap/ui",["two/minimap","two/locale","two/ui","two/ui/autoComplete","two/FrontButton","two/utils","two/eventQueue","ejs","struct/MapData","cdn"],function(a,b,d,h,i,j,k,l,m,n){var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,D={},E=function(a,b){e.emit(f.TRIBE_GET_PROFILE,{tribe_id:a},b)},F=function(a,b){e.emit(f.CHAR_GET_PROFILE,{character_id:a},b)},G=function(a,b,c){m.loadTownDataAsync(a,b,1,1,c)},H=function(c,d){var e=document.createElement("tr");e.id=c.type+"-"+c.id,e.innerHTML=l.render('<td><span class="icon-26x26-rte-<#= type #>"></span></td><td class="entry-name"></td><td><input class="entry-color" style="background:<#= color #>" disabled="disabled"></td><td><a href="#" class="entry-remove size-26x26 btn-red icon-20x20-close" tooltip="<#= locale("minimap", "remove") #>"></a></td>',{type:c.type,id:c.id,color:d,locale:b}),r[c.type].append(e);var f=e.querySelector(".entry-name");switch(e.querySelector(".entry-remove").addEventListener("click",function(){a.removeHighlight(c)}),c.type){case"tribe":E(c.id,function(a){f.innerHTML=a.name});break;case"character":F(c.id,function(a){f.innerHTML=a.character_name});break;case"village":G(c.x,c.y,function(a){f.innerHTML=j.genVillageLabel(a)})}o.setTooltips()},I=function(a){var b=o.$window.querySelector("#"+a.type+"-"+a.id);b&&b.remove()},J=function(){a.eachHighlight(function(a,b,c){var d={type:a,id:b};"village"===a&&(d.x=c.x,d.y=c.y),H(d,c.color)})},K=function(a,b){z.villageName.html(j.genVillageLabel(a)),z.villagePoints.html(a.points.toLocaleString()),a.character_id?(z.playerName.html(a.character_name),z.playerPoints.html(a.character_points.toLocaleString())):(z.playerName.html("-"),z.playerPoints.html("-")),a.tribe_id?(z.tribeName.html(a.tribe_name+"("+a.tribe_tag+")"),z.tribePoints.html(a.tribe_points.toLocaleString())):(z.tribeName.html("-"),z.tribePoints.html("-")),z.provinceName.html(a.province_name),y.css("display",""),y.css("top",b.pageY-83+"px"),y.css("left",b.pageX+80+"px")},L=function(){y.css("display","none")},M=function(){s.on("input",function(){var a=s.val();if(a.length<2)return h.hide();h.search(a,function(a){a.length&&h.show(a,s[0],"minimap")})}),w.on("click",function(){a.addHighlight(D,v.val())}),v.on("focus",Q),v.on("blur",function(){setTimeout(R,150)}),v.on("keyup",function(){P(this.value)}),x.find("td").on("click",function(){P(this.dataset.color),R()}),c.$on(g.SELECT_SELECTED,function(a,b,c){if("minimap"!==b)return!1;D.id=c.id,D.type=c.type,"village"===c.type&&(D.x=c.x,D.y=c.y),t[0].className="icon-26x26-rte-"+c.type,u.html(c.name)}),k.bind("minimap/highlight/add",function(a,c){H(a,c),j.emitNotif("success",b("minimap","highlight/add/success"))}),k.bind("minimap/highlight/remove",function(a){I(a),j.emitNotif("success",b("minimap","highlight/remove/success"))}),k.bind("minimap/highlight/add/error/exists",function(){j.emitNotif("error",b("minimap","highlight/add/error/exists"))}),k.bind("minimap/highlight/add/error/no-entry",function(){j.emitNotif("error",b("minimap","highlight/add/error/no-entry"))}),k.bind("minimap/highlight/add/error/invalid-color",function(){j.emitNotif("error",b("minimap","highlight/add/error/invalid-color"))}),k.bind("minimap/villageHover",K),k.bind("minimap/villageBlur",L),k.bind("minimap/mouseLeave",function(){L(),A.trigger("mouseup")}),k.bind("minimap/start-move",function(){L(),A.css("cursor","url("+n.getPath("/img/cursor/grab_pushed.png")+"), move")}),k.bind("minimap/stop-move",function(){A.css("cursor","")})},N=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},O=function(a){var b=N(a);return(299*b.r+587*b.g+114*b.b)/1e3>127.5?"#000":"#fff"},P=function(a){if(!C.test(a))return!1;v.val(a),v.css("background",a),v.css("color",O(a))},Q=function(){x[0].style.display=""},R=function(){x.hide()},S=function(){var c=["#000000","#010067","#d5ff00","#ff0056","#9e008e","#0e4ca1","#ffe502","#005f39","#00ff00","#95003a","#ff937e","#a42400","#001544","#91d0cb","#620e00","#6b6882","#0000ff","#007db5","#6a826c","#00ae7e","#c28c9f","#be9970","#008f9c","#5fad4e","#ff0000","#ff00f6","#ff029d","#683d3b","#ff74a3","#968ae8","#98ff52","#a75740","#01fffe","#ffeee8","#fe8900","#bdc6ff","#01d0ff","#bb8800","#7544b1","#a5ffd2","#ffa6fe","#774d00","#7a4782","#263400","#004754","#43002c","#b500ff","#ffb167","#ffdb66","#90fb92","#7e2dd2","#bdd393","#e56ffe","#deff74","#00ff78","#009bff","#006401","#0076ff","#85a900","#00b917","#788231","#00ffc6","#ff6e41","#e85ebe"];return o=new d("Minimap",{activeTab:"minimap",template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2><#= locale("minimap", "title") #> <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="tabs tabs-bg"><div class="tabs-two-col"><div class="tab" tab="minimap"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("minimap", "minimap") #></a></div></div></div><div class="tab" tab="highlights"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("minimap", "highlights") #></a></div></div></div></div></div><div class="win-main"><div class="box-paper footer has-footer-upper twOverflow-content-minimap"><canvas class="cross"></canvas><canvas class="minimap"></canvas></div><div class="box-paper footer has-footer-upper twOverflow-content-highlights"><h5 class="twx-section"><#= locale("minimap", "add") #></h5><form class="addForm"><table class="tbl-border-light tbl-striped"><colgroup><col width="30%"><col width="6%"><col><col width="12%"><col width="7%"></colgroup><tbody><tr><td class="item-input"><input type="text" class="textfield-border" autocomplete="off" placeholder="<#= locale("minimap", "entry/id") #>"></td><td><span class="item-icon"></span></td><td class="item-name"></td><td class="item-color"><input type="text" class="textfield-border" value="#000000" tooltip="<#= locale("minimap", "color") #>"></td><td class="item-add"><span class="btn-orange icon-26x26-plus" tooltip="<#= locale("minimap", "add") #>"></span></td></tr></tbody></table><table class="tbl-border-light tbl-striped color-picker" style="display: none"><tbody><tr> <# colors.forEach(function (color) { #> <td style="background: <#= color #>" data-color="<#= color #>"></td> <# }) #> </tr></tbody></table></form><div class="highlights"><h5 class="twx-section"><#= locale("minimap", "highlights") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="6%"><col><col width="7%"><col width="7%"></colgroup> <# types.forEach(function (type) { #> <tbody class="<#= type #>"></tbody> <# }) #> </table></div></div></div></div><div class="minimap-tooltip box-border-darker box-wrapper" style="display: none"><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col width="50%"></colgroup><tbody><tr><td class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-26x26-village"></span><div class="text"><span>Village</span> <span class="overflow-ellipsis village-name"></span></div></div></td><td class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-26x26-points"></span><div class="text"><span>Village points</span> <span class="village-points"></span></div></div></td></tr><tr><td class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-34x34-player"></span><div class="text text-limited"><span>Player name</span> <span class="overflow-ellipsis player-name"></span></div></div></td><td class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-26x26-points"></span><div class="text"><span>Player Points</span> <span class="player-points"></span></div></div></td></tr><tr><td class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-34x34-tribe"></span><div class="text text-limited"><span>Tribe name</span> <span class="overflow-ellipsis tribe-name"></span></div></div></td><td class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-34x34-tribe-points"></span><div class="text"><span>Tribe points</span> <span class="tribe-points"></span></div></div></td></tr><tr><td colspan="2" class="cell-space-left"><div class="ff-cell-fix"><span class="size-34x34 icon-bg-black icon-34x34-province"></span><div class="text"><span>Province name</span> <span class="overflow-ellipsis province-name"></span></div></div></td></tr></tbody></table></div>',css:'#Minimap .minimap{background:#436213;position:absolute;left:0;top:0;z-index:0}#Minimap .cross{position:absolute;left:0;top:0;z-index:2}#Minimap .addForm input{width:100%}#Minimap .addForm .item-color input{font-weight:100}#Minimap .addForm td{text-align:center}#Minimap .highlights table{margin-bottom:10px}#Minimap .highlights td{text-align:center}#Minimap .highlights td.entry-name{text-align:left}#Minimap .entry-color{background:#000000;height:26px;width:26px;display:inline-block;box-shadow:0 0 0 1px #421f09 inset,0 0 0 2px #976543 inset,0 0 0 3px #421f09 inset,0 0 1px 5px rgba(0,0,0,0.4) inset;text-shadow:1px 1px 0 #000;outline:none;border:none}#Minimap .entry-name{text-align:left;padding:0 10px}#Minimap .color-picker{height:30px;margin-top:11px}#Minimap .minimap-tooltip{position:absolute;width:440px;z-index:4000;padding:3px;background:url("data:image/png; base64,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") #45505c;transition:opacity .5s;top:20px;left:20px}#Minimap .minimap-tooltip.left{left:-410px}#Minimap .minimap-tooltip.top{top:-220px}#Minimap .minimap-tooltip .text span{width:100%;float:left;line-height:17px;font-size:13px;display:inline-block}#Minimap .minimap-tooltip .text-limited span{width:180px}',replaces:{locale:b,version:a.version,types:["village","character","tribe"],colors:c},onTabClick:function(a){"minimap"===a?o.$scrollbar.disable():o.$scrollbar.enable()}}),p=new i("Minimap",{classHover:!1,classBlur:!1,onClick:function(){var b=a.getMapPosition();a.setCurrentPosition(b[0],b[1]),o.openWindow()}}),o.$scrollbar.disable(),q=$(o.$window),s=q.find(".item-input input"),t=q.find(".item-icon"),u=q.find(".item-name"),v=q.find(".item-color input"),w=q.find(".item-add span"),x=q.find(".color-picker"),y=q.find(".minimap-tooltip"),z={villageName:y.find(".village-name"),villagePoints:y.find(".village-points"),playerName:y.find(".player-name"),playerPoints:y.find(".player-points"),tribeName:y.find(".tribe-name"),tribePoints:y.find(".tribe-points"),provinceName:y.find(".province-name")},r={village:q.find(".village"),character:q.find(".character"),tribe:q.find(".tribe")},A=q.find(".cross"),B=q.find(".minimap"),a.setViewport(B[0]),a.setCross(A[0]),M(),J(),a.interfaceInitialized=!0,o};a.interface=function(){a.interface=S()}}),define("two/queue",["two/locale","two/utils","two/eventQueue","helper/time","helper/math","struct/MapData","conf/conf","Lockr"],function(b,c,g,h,i,j,l,m){var n,o,p=[],q={},r=[],s=[],t=!1,u={selectedVillage:function(a){return a.origin.id===d.getSelectedVillage().getId()},barbarianTarget:function(a){return!a.target.character_id},allowedTypes:function(a,b){return b.allowedTypes[a.type]},attack:function(a){return"attack"!==a.type},support:function(a){return"support"!==a.type},relocate:function(a){return"relocate"!==a.type},textMatch:function(a,b){var c=!0,d=b.textMatch.toLowerCase().split(/\W/),e=[a.origin.name,a.originCoords,a.originCoords,a.origin.character_name||"",a.target.name,a.targetCoords,a.target.character_name||"",a.target.tribe_name||"",a.target.tribe_tag||""];return e=e.join("").toLowerCase(),d.some(function(a){if(a.length&&!e.includes(a))return c=!1,!0}),c}},v=function(a){return a<h.gameTime()+o},w=function(a){var b={};for(var c in a){var d=a[c];"*"!==d&&0===d||(b[c]=d)}return b},x=function(){p=p.sort(function(a,b){return a.sendTime-b.sendTime})},y=function(a){p.push(a)},z=function(a){q[a.id]=a},A=function(a){r.push(a)},B=function(a){s.push(a)},C=function(){m.set("queue-commands",p)},D=function(){m.set("queue-sent",r)},E=function(){m.set("queue-expired",s)},F=function(){var a=m.get("queue-commands",[],!0);if(a.length)for(var b=0;b<a.length;b++){var c=a[b];h.gameTime()>c.sendTime?I.expireCommand(c):(y(c),z(c))}},G=function(a){var b=d.getVillages(),c=b[a.origin.id];if(!c)return!1;var e=c.unitInfo.units,f={};for(var g in a.units){var h=a.units[g];if("*"===h){if(0===(h=e[g].available))continue}else if(h<0&&(h=e[g].available-Math.abs(h))<0)return!1;f[g]=h}return f},H=function(){setInterval(function(){p.length&&p.some(function(a){if(!v(a.sendTime))return!0;t?I.sendCommand(a):I.expireCommand(a)})},100)},I={};return I.initialized=!1,I.version="1.1.1",I.init=function(){b.create("queue",{en:{title:"CommandQueue",attack:"Attack",support:"Support",relocate:"Transfer",sent:"sent",activated:"enabled",deactivated:"disabled",expired:"expired",removed:"removed",added:"added","general.clear":"Clear registers","general.nextCommand":"Next command","add.basics":"Basic information","add.origin":"Origin","add.addSelected":"Active village","add.target":"Target","add.addMapSelected":"Selected village on a map","add.arrive":"Command arrive at date","add.out":"Command leave at date","add.currentDate":"Current date","add.travelTimes":"Unit travel time","add.date":"Date/time","add.no-village":"select a village...","add.village-search":"Village search...","queue.waiting":"Waiting commands","queue.noneAdded":"No command added.","queue.sent":"Commands sent","queue.noneSent":"No command sent.","queue.expired":"Expired commands","queue.noneExpired":"No command expired.","queue.remove":"Remove command form list","queue.filters":"Filter commands","filters.selectedVillage":"Show only commands from the selected village","filters.barbarianTarget":"Show only commands with barbarian villages as target","filters.attack":"Show attacks","filters.support":"Show supports","filters.relocate":"Show transfers","filters.textMatch":"Filter by text...","command.out":"Out","command.timeLeft":"Time remaining","command.arrive":"Arrival","error.noUnitsEnough":"Without the enough units to send the command!","error.origin":"Invalid origin village!","error.target":"Invalid target village!","error.noUnits":"No units specified!","error.invalidDate":"Invalid date","error.alreadySent":"This %{type} should have left %{date}","error.originNotExist":"Specified origin village does not exist!","error.targetNotExist":"Specified target village does not exist!","error.noMapSelectedVillage":"No selected village on map.","error.removeError":"Error removing command."},pt:{title:"CommandQueue",attack:"Ataque",support:"Apoio",relocate:"TransferÃªncia",sent:"enviado",activated:"ativado",deactivated:"desativado",expired:"expirado",removed:"removido",added:"adicionado","general.clear":"Limpar registros","general.nextCommand":"PrÃ³ximo comando","add.basics":"InformaÃ§Ãµes bÃ¡sicas","add.origin":"Coordenadas da origem","add.addSelected":"Aldeia ativa","add.target":"Coordenadas do alvo","add.addMapSelected":"Aldeia selecionada no mapa","add.arrive":"Data de chegada","add.out":"Data de saÃ­da","add.currentDate":"Data/hora","add.travelTimes":"Tempos de viagem","add.date":"Data","add.no-village":"selecione uma aldeia...","add.village-search":"Procurar aldeia...","queue.waiting":"Comandos em espera","queue.noneAdded":"Nenhum comando adicionado.","queue.sent":"Comandos enviados","queue.noneSent":"Nenhum comando enviado.","queue.expired":"Comandos expirados","queue.noneExpired":"Nenhum comando expirado.","queue.remove":"Remover comando da lista","queue.filters":"Filtro de comandos","filters.selectedVillage":"Mostrar apenas comandos com origem da aldeia selecionada","filters.barbarianTarget":"Mostrar apenas comandos com aldeias bÃ¡rbaras como alvo","filters.attack":"Mostrar ataques","filters.support":"Mostrar apoios","filters.relocate":"Mostrar transferÃªncias","filters.textMatch":"Filtrar por texto...","command.out":"SaÃ­da na data","command.timeLeft":"Tempo restante","command.arrive":"Chegada na data","error.noUnitsEnough":"Sem unidades o sulficientes para enviar o comando!","error.origin":"Aldeia de origem invÃ¡lida!","error.target":"Aldeia alvo invÃ¡lida!","error.noUnits":"Nenhuma unidade especificada!","error.invalidDate":"Data invÃ¡lida","error.alreadySent":"Esse %{type} deveria ter saÃ­do %{date}","error.originNotExist":"Aldeia de origem especificada nÃ£o existe!","error.targetNotExist":"Aldeia alvo especificada nÃ£o existe!","error.noMapSelectedVillage":"Nenhuma aldeia selecionada no mapa.","error.removeError":"Erro ao remover comando."}},"en"),o=c.getTimeOffset(),n=d.getSelectedCharacter(),I.initialized=!0,r=m.get("queue-sent",[],!0),s=m.get("queue-expired",[],!0),F(),H(),a.addEventListener("beforeunload",function(a){t&&p.length&&(a.returnValue=!0)})},I.sendCommand=function(a){if(a.units=G(a),!a.units)return g.trigger("Queue/error",[b("queue","error.noUnitsEnough")]);e.emit(f.SEND_CUSTOM_ARMY,{start_village:a.origin.id,target_village:a.target.id,type:a.type,units:a.units,icon:0,officers:a.officers,catapult_target:a.catapultTarget}),A(a),D(),I.removeCommand(a,"sent"),g.trigger("Queue/send",[a])},I.expireCommand=function(a){B(a),E(),I.removeCommand(a,"expired")},I.addCommand=function(a){if(!a.origin)return g.trigger("Queue/error",[b("queue","error.origin")]);if(!a.target)return g.trigger("Queue/error",[b("queue","error.target")]);if(!c.isValidDateTime(a.date))return g.trigger("Queue/error",[b("queue","error.invalidDate")]);if(angular.equals(a.units,{}))return g.trigger("Queue/error",[b("queue","error.noUnits")]);a.originCoords=a.origin.x+"|"+a.origin.y,a.targetCoords=a.target.y+"|"+a.target.y;var d=new Promise(function(b,c){I.getVillageByCoords(a.origin.x,a.origin.y,function(a){if(a)return b(a);c("error.originNotExist")})}),e=new Promise(function(b,c){I.getVillageByCoords(a.target.x,a.target.y,function(a){if(a)return b(a);c("error.originNotExist")})}),f=Promise.all([d,e]);f.then(function(d){a.origin=d[0],a.target=d[1],a.units=w(a.units),a.date=c.fixDate(a.date),a.travelTime=I.getTravelTime(a.origin,a.target,a.units,a.type,a.officers);var e=c.getTimeFromString(a.date);if("arrive"===a.dateType?(a.sendTime=e-a.travelTime,a.arriveTime=e):(a.sendTime=e,a.arriveTime=e+a.travelTime),v(a.sendTime))return g.trigger("Queue/error",[b("queue","error.alreadySent",{date:c.formatDate(a.sendTime),type:b("common",a.type)})]);"attack"===a.type&&"supporter"in a.officers&&delete a.officers.supporter;for(var f in a.officers)a.officers[f]=1;"attack"===a.type&&a.units.catapult?a.catapultTarget=a.catapultTarget||"headquarter":a.catapultTarget=null,a.id=c.guid(),y(a),z(a),x(),C(),g.trigger("Queue/add",[a])}),f.catch(function(a){g.trigger("Queue/error",[b("queue",a)])})},I.removeCommand=function(a,b){delete q[a.id];for(var c=0;c<p.length;c++)if(p[c].id==a.id)return p.splice(c,1),"expired"===b?g.trigger("Queue/expired",[a]):"removed"===b&&g.trigger("Queue/remove",[!0,a,!0]),C();g.trigger("Queue/remove",[!1])},I.clearRegisters=function(){m.set("queue-expired",[]),m.set("queue-sent",[]),s=[],r=[]},I.start=function(a){t=!0,g.trigger("Queue/start",[a])},I.stop=function(){t=!1,g.trigger("Queue/stop")},I.isRunning=function(){return t},I.getWaitingCommands=function(){return p},I.getWaitingCommandsObject=function(){return q},I.getSentCommands=function(){return r},I.getExpiredCommands=function(){return s},I.getTravelTime=function(a,b,c,d,e){var f=!1,g=null===b.character_id,h=b.character_id&&b.tribe_id&&b.tribe_id===n.getTribeId();"attack"===d?("supporter"in e&&delete e.supporter,g&&(f=!0)):"support"===d&&(h&&(f=!0),"supporter"in e&&(f=!0));var j={units:c,officers:angular.copy(e)},l=k.calculateTravelTime(j,{barbarian:g,ownTribe:h,officers:e,effects:f},d),m=i.actualDistance(a,b);return 1e3*k.getTravelTimeForDistance(j,l,m,d)},I.getVillageByCoords=function(a,b,c){j.loadTownDataAsync(a,b,1,1,c)},I.filterCommands=function(a,b,c){var d=u[a];return(c||p).filter(function(a){return d(a,b)})},I}),define("two/queue/analytics",["two/queue","two/eventQueue"],function(a,b){a.analytics=function(){ga("create","UA-102282823-1","auto","CommandQueue");var a=d.getPlayer(),c=a.getSelectedCharacter(),e=[];e.push(c.getName()),e.push(c.getId()),e.push(c.getWorldId()),b.bind("Queue/send",function(a){ga("CommandQueue.send","event","commands",a.type,e.join("~"))}),b.bind("Queue/expired",function(){ga("CommandQueue.send","event","commands","expired",e.join("~"))})}}),require(["two/ready","two/queue","two/queue/ui","two/queue/analytics"],function(a,b){if(b.initialized)return!1;a(function(){b.init(),b.interface(),b.analytics(),b.getWaitingCommands().length>0&&b.start(!0)})}),define("two/queue/ui",["two/queue","two/locale","two/ui","two/ui/buttonLink","two/ui/autoComplete","two/FrontButton","two/utils","two/eventQueue","helper/time","ejs"],function(a,b,e,f,h,i,j,k,l,m){function o(){I=j.getTimeOffset(),H=Object.keys(N.getBuildings()),F=d.getSelectedCharacter();var c={version:a.version,locale:b,units:Ca(),officers:S,buildings:H};return p=new e("CommandQueue",{activeTab:"add",
template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2><#= locale("queue", "title") #> <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" tab="add"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "add") #></a></div></div></div><div class="tab" tab="queue"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "waiting") #></a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange"><#= locale("common", "logs") #></a></div></div></div></div></div><div class="win-main"><div class="box-paper footer has-footer-upper rich-text twOverflow-content-add"><form class="addForm"><div><table class="tbl-border-light tbl-striped"><colgroup><col width="30%"><col width="5%"><col><col width="14%"></colgroup><tbody><tr><td><input data-setting="origin" type="text" class="textfield-border origin" pattern="\\d{2,3}\\|\\d{2,3}" placeholder="<#= locale("queue", "add.village-search") #>" required></td><td class="text-center"><span class="icon-26x26-rte-village"></span></td><td class="originVillage"><#= locale("queue", "add.no-village") #></td><td class="actions"><a class="btn btn-orange addSelected" tooltip="<#= locale("queue", "add.addSelected") #>"><#= locale("common", "selected") #></a></td></tr><tr><td><input data-setting="target" type="text" class="textfield-border target" pattern="\\d{2,3}\\|\\d{2,3}" placeholder="<#= locale("queue", "add.village-search") #>" required></td><td class="text-center"><span class="icon-26x26-rte-village"></span></td><td class="targetVillage"><#= locale("queue", "add.no-village") #></td><td class="actions"><a class="btn btn-orange addMapSelected" tooltip="<#= locale("queue", "add.addMapSelected") #>"><#= locale("common", "selected") #></a></td></tr><tr><td><input data-setting="date" type="text" class="textfield-border date" pattern="\\s*\\d{1,2}:\\d{1,2}:\\d{1,2}(:\\d{1,3})? \\d{1,2}\\/\\d{1,2}\\/\\d{4}\\s*" placeholder="<#= locale("queue", "add.date") #>" tooltip="00:00:00:000 00/00/0000" required></td><td class="text-center"><span class="icon-26x26-time"></span></td><td><span class="ff-cell-fix"><select data-setting="dateType" class="dateType"><option value="arrive" selected="selected"><#= locale("queue", "add.arrive") #></option><option value="out"><#= locale("queue", "add.out") #></option></select></span></td><td class="actions"><a class="btn btn-orange addCurrentDate" tooltip="<#= locale("queue", "add.currentDate") #>"><#= locale("common", "now") #></a></td></tr></tbody></table><table class="tbl-border-light tbl-units tbl-speed travelTimes" style="display:none"><thead><tr><th colspan="7"><#= locale("queue", "add.travelTimes") #></th></tr></thead><tbody><tr><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-knight"></span> <span class="icon icon-34x34-unit-light_cavalry"></span> <span class="icon icon-34x34-unit-mounted_archer"></span></div><div class="travelTime box-time-sub-icon"><div class="time-icon icon-20x20-attack"></div><span class="attack" unit="knight"></span></div><div class="travelTime box-time-sub-icon"><div class="time-icon icon-20x20-support"></div><span class="support" unit="knight"></span></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-heavy_cavalry"></span></div><div class="travelTime"><span class="attack" unit="heavy_cavalry"></span></div><div class="travelTime"><span class="support" unit="heavy_cavalry"></span></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-archer"></span> <span class="icon icon-34x34-unit-spear"></span> <span class="icon icon-34x34-unit-axe"></span> <span class="icon icon-34x34-unit-doppelsoldner"></span></div><div class="travelTime"><span class="attack" unit="axe"></span></div><div class="travelTime"><span class="support" unit="axe"></span></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-sword"></span></div><div class="travelTime"><span class="attack" unit="sword"></span></div><div class="travelTime"><span class="support" unit="sword"></span></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-catapult"></span> <span class="icon icon-34x34-unit-ram"></span></div><div class="travelTime"><span class="attack" unit="ram"></span></div><div class="travelTime"><span class="support" unit="ram"></span></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-snob"></span></div><div class="travelTime"><span class="attack" unit="snob"></span></div><div class="travelTime"><span class="support" unit="snob"></span></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-trebuchet"></span></div><div class="travelTime"><span class="attack" unit="trebuchet"></span></div><div class="travelTime"><span class="support" unit="trebuchet"></span></div></td></tr></tbody></table></div><h5 class="twx-section collapse"><#= locale("common", "units") #></h5><table class="tbl-border-light tbl-striped"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><tbody class="add-units"><tr> <# units.forEach(function(unit, i) { #> <# if (i !== 0 && i % 4 === 0) { #> </tr><tr> <# } #> <td class="cell-space-left"><span class="unit-icon icon-bg-black icon-34x34-unit-<#= unit #>"></span> <input class="unit <#= unit #>" type="text" data-setting="<#= unit #>" placeholder="0"></td> <# }) #> <td class="text-center catapult-target" style="display:none" colspan="3"><select data-setting="catapultTarget"> <# buildings.forEach(function(building, i) { #> <# if (building === "headquarter") { #> <option value="headquarter" selected="selected"><#= locale("common", "headquarter") #></option> <# } else { #> <option value="<#= building #>"><#= locale("common", building) #></option> <# } #> <# }) #> </select></td></tr></tbody></table><h5 class="twx-section collapse"><#= locale("common", "officers") #></h5><table class="tbl-border-light tbl-striped officers"><tbody><tr> <# officers.forEach(function(officer) { #> <td><span class="icon-34x34-premium_officer_<#= officer #>"></span> <label class="btn-orange icon-26x26-checkbox"><input type="checkbox" data-setting="<#= officer #>" class="<#= officer #>"></label></td> <# }) #> </tr></tbody></table></form></div><div class="box-paper footer has-footer-upper rich-text twOverflow-content-queue"><div class="filters"><table class="tbl-border-light"><tbody><tr><td><div data-filter="selectedVillage" class="box-border-dark icon selectedVillage" tooltip="<#= locale("queue", "filters.selectedVillage") #>"><span class="icon-34x34-village-info icon-bg-black"></span></div><div data-filter="barbarianTarget" class="box-border-dark icon barbarianTarget" tooltip="<#= locale("queue", "filters.barbarianTarget") #>"><span class="icon-34x34-barbarian-village icon-bg-black"></span></div><div data-filter="attack" class="box-border-dark icon allowedTypes active" tooltip="<#= locale("queue", "filters.attack") #>"><span class="icon-34x34-attack icon-bg-black"></span></div><div data-filter="support" class="box-border-dark icon allowedTypes active" tooltip="<#= locale("queue", "filters.support") #>"><span class="icon-34x34-support icon-bg-black"></span></div><div data-filter="relocate" class="box-border-dark icon allowedTypes active" tooltip="<#= locale("queue", "filters.relocate") #>"><span class="icon-34x34-relocate icon-bg-black"></span></div><div class="text"><input data-filter="textMatch" type="text" class="box-border-dark textMatch" placeholder="<#= locale("queue", "filters.textMatch") #>"></div></td></tr></tbody></table></div><h5 class="twx-section collapse"><#= locale("queue", "queue.waiting") #></h5><div class="queue"><p class="center nothing"><#= locale("queue", "queue.noneAdded") #></p></div></div><div class="box-paper footer has-footer-upper rich-text twOverflow-content-log"><h5 class="twx-section collapse"><#= locale("queue", "queue.sent") #></h5><div class="sent"><p class="center nothing"><#= locale("queue", "queue.noneSent") #></p></div><h5 class="twx-section collapse"><#= locale("queue", "queue.expired") #></h5><div class="expired"><p class="center nothing"><#= locale("queue", "queue.noneExpired") #></p></div></div></div><footer class="win-foot"><ul class="list-btn list-center buttons"><li class="twOverflow-button-log"><a class="btn-orange btn-border clear"><#= locale("queue", "general.clear") #></a></li><li class="twOverflow-button-add"><a class="btn-orange btn-border add" name="attack"><span class="icon-26x26-attack-small"></span> <#= locale("common", "attack") #></a></li><li class="twOverflow-button-add"><a class="btn-orange btn-border add" name="support"><span class="icon-26x26-support"></span> <#= locale("common", "support") #></a></li><li class="twOverflow-button-add"><a class="btn-orange btn-border add" name="relocate"><span class="icon-26x26-relocate"></span> <#= locale("common", "relocate") #></a></li><li><a class="btn-green btn-border switch"><#= locale("common", "activate") #></a></li></ul></footer></div>',replaces:c,css:'#CommandQueue input[type="text"]{width:200px}#CommandQueue input.unit{width:80px;height:34px}#CommandQueue form .padded{padding:2px 8px}#CommandQueue .custom-select{width:240px}#CommandQueue .originVillage,#CommandQueue .targetVillage{padding:0 7px}#CommandQueue .actions{text-align:center}#CommandQueue .actions a{height:26px;line-height:26px;padding:0 10px}#CommandQueue .add-units td{text-align:center}#CommandQueue .add-units .unit-icon{top:-1px}#CommandQueue .add-units input{height:34px;line-height:26px;color:#000;font-size:14px;background:url(data:image/png;base64,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) top left #b89064;box-shadow:inset 0 0 0 1px #000,inset 0 0 0 2px #a2682c,inset 0 0 0 3px #000,inset -3px -3px 2px 0 #fff,inset 0 0 9px 5px rgba(99,54,0,0.5);text-align:center;width:80px}#CommandQueue .command{margin-bottom:10px}#CommandQueue .command .time-left{width:93px;display:inline-block;padding:0 0 0 3px}#CommandQueue .command .sent-time,#CommandQueue .command .arrive-time{width:160px;display:inline-block;padding:0 0 0 5px}#CommandQueue .command td{padding:3px 6px}#CommandQueue .officers td{width:111px;text-align:center}#CommandQueue .officers label{margin-left:5px}#CommandQueue .officers span{margin-left:2px}#CommandQueue .units div.unit{float:left}#CommandQueue .units div.unit span.icon{transform:scale(.7);width:25px;height:25px}#CommandQueue .units div.unit span.amount{vertical-align:-2px;margin:0 5px 0 2px}#CommandQueue .units div.officer{float:left;margin:0 2px}#CommandQueue .units div.officer span{transform:scale(.7);width:25px;height:25px}#CommandQueue .remove-command{float:right;margin-top:3px}#CommandQueue .tbl-units td{text-align:center}#CommandQueue .travelTimes{margin-top:10px;font-size:13px}#CommandQueue .travelTimes th{text-align:center}#CommandQueue .travelTimes .travelTime{display:block;color:#1c4b1c}#CommandQueue .travelTimes .travelTime.box-time-sub-icon{position:relative}#CommandQueue .travelTimes .travelTime.box-time-sub-icon .time-icon{position:absolute;top:-4px;left:7px;transform:scale(.7)}#CommandQueue .dateType{width:200px}#CommandQueue .dateType .custom-select-handler{text-align:left}#CommandQueue .filters .icon{width:38px;float:left;margin:0 6px}#CommandQueue .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#CommandQueue .filters .text{margin-left:262px}#CommandQueue .filters .text input{height:36px;margin-top:1px;width:100%;text-align:left;padding:0 5px}#CommandQueue .filters .text input::placeholder{color:white}#CommandQueue .filters .text input:focus::placeholder{color:transparent}#CommandQueue .filters td{padding:6px}#CommandQueue .icon-34x34-barbarian-village:before{filter:grayscale(100%);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-220px -906px}#CommandQueue .icon-20x20-time-arrival:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-529px -454px}#CommandQueue .icon-20x20-attack:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px;width:26px;height:26px}#CommandQueue .icon-20x20-support:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-462px -360px;width:26px;height:26px}#CommandQueue .icon-20x20-relocate:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-1090px -130px;width:26px;height:26px}#CommandQueue .icon-26x26-attack:before{background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px}'}),q=new i("Commander"),q.hover(function(){var c=a.getWaitingCommands(),d=c.length?j.formatDate(c[0].sendTime):b("common","none"),e=b("queue","general.nextCommand")+": "+d;q.updateQuickview(e)}),q.click(function(){p.openWindow()}),r=$(p.$window),s=r.find("a.switch"),t=r.find("form.addForm"),u=r.find("input.origin"),v=r.find("input.target"),w=r.find("input.date"),x=r.find(".officers input"),$travelTimes=r.find("table.travelTimes"),z=r.find(".dateType"),A=r.find(".filters"),B=r.find("td.catapult-target"),C=r.find("input.unit.catapult"),D=r.find(".originVillage"),E=r.find(".targetVillage"),y={queue:r.find("div.queue"),sent:r.find("div.sent"),expired:r.find("div.expired")},["attack","support"].forEach(function(a){$travelTimes.find("."+a).forEach(function(b){var c=b.getAttribute("unit");J[a][c]=b})}),k.bind("Queue/error",function(a){j.emitNotif("error",a)}),k.bind("Queue/remove",function(a,c){if(!a)return j.emitNotif("error",b("queue","error.removeError"));oa(c,"queue"),j.emitNotif("success",za(c.type,"removed"))}),k.bind("Queue/expired",function(a){oa(a,"queue"),pa(a,"expired"),j.emitNotif("error",za(a.type,"expired"))}),k.bind("Queue/add",function(a){ea(),ua(),j.emitNotif("success",za(a.type,"added"))}),k.bind("Queue/send",function(a){oa(a,"queue"),pa(a,"sent"),j.emitNotif("success",za(a.type,"sent"))}),k.bind("Queue/start",function(a){q.$elem.removeClass("btn-green").addClass("btn-red"),s.removeClass("btn-green").addClass("btn-red"),s.html(b("common","deactivate")),a||j.emitNotif("success",za("title","activated"))}),k.bind("Queue/stop",function(){q.$elem.removeClass("btn-red").addClass("btn-green"),s.removeClass("btn-red").addClass("btn-green"),s.html(b("common","activate")),j.emitNotif("success",za("title","deactivated"))}),setInterval(function(){Z()&&ia()},1e3),wa(),xa(),_(),qa(),p}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J={attack:{},support:{}},K=null,L=null,M={},N=d.getGameData(),O={origin:!1,target:!1,date:!1},P={selectedVillage:!1,barbarianTarget:!1,allowedTypes:!0,attack:!0,support:!0,relocate:!0,textMatch:!0},Q=["selectedVillage","barbarianTarget","allowedTypes","textMatch"],R={allowedTypes:{attack:!0,support:!0,relocate:!0},textMatch:""},S=N.getOrderedOfficerNames(),T=N.getOrderedUnitNames(),U=["knight","heavy_cavalry","axe","sword","ram","snob","trebuchet"],V="arrive",W=!1,X=function(){$travelTimes.css("display","none")},Y=function(){$travelTimes.css("display","")},Z=function(){return p.isVisible("add")&&O.origin&&O.target&&O.date},_=function(a){ca(),aa(),ba(),ua()},aa=function(){a.getSentCommands().forEach(function(a){pa(a,"sent")})},ba=function(){a.getExpiredCommands().forEach(function(a){pa(a,"expired")})},ca=function(){a.getWaitingCommands().forEach(function(a){pa(a,"queue")})},da=function(){y.queue.find(".command").remove(),M={}},ea=function(){da(),ca()},fa=function(a){return T.includes(a)},ga=function(a){return S.includes(a)},ha=function(){var a=new Date(l.gameTime()+j.getTimeOffset()),b=l.zerofill(a.getMilliseconds(),3),c=l.zerofill(a.getSeconds(),2),d=l.zerofill(a.getMinutes(),2);return l.zerofill(a.getHours(),2)+":"+d+":"+c+":"+b+" "+l.zerofill(a.getDate(),2)+"/"+l.zerofill(a.getMonth()+1,2)+"/"+a.getFullYear()},ia=function(){if(!O.origin||!O.target)return $travelTimes.hide();var b=(u.val(),v.val(),Ba());if(O.date)var c=j.fixDate(w.val()),d=j.getTimeFromString(c);["attack","support"].forEach(function(c){U.forEach(function(e){var f={};f[e]=1;var g=a.getTravelTime(K,L,f,c,b),h=n("readableMillisecondsFilter")(g);if("arrive"===V)if(O.date){var i=d-g;Aa(i)||(h=ja(h))}else h=ja(h);J[c][e].innerHTML=h})}),Y()},ja=function(a){return'<span class="text-red">'+a+"</span>"},ka=function(a){a.css("color","#a1251f")},la=function(a){a.css("color","")},ma=function(a){r.find("[data-setting]").forEach(function(b){var c=b.dataset.setting;a(b,c)})},na=function(b){var c={units:{},officers:{},type:b,origin:K,target:L};ma(function(a,b){var d=a.value;if("dateType"===b)c.dateType=a.dataset.value;else if("catapultTarget"===b)c.catapultTarget=a.dataset.value||null;else{if(!d)return!1;fa(b)?c.units[b]=isNaN(d)?d:parseInt(d,10):ga(b)?a.checked&&(c.officers[b]=1):d&&(c[b]=d)}}),a.addCommand(c)},oa=function(a,b){var c=y[b].find(".command").filter(function(b){return b.dataset.id===a.id});$(c).remove(),sa(a.id),va(b),p.isVisible("queue")&&p.recalcScrollbar()},pa=function(c,d){var e=document.createElement("div");e.dataset.id=c.id,e.className="command";var g=f("village",j.genVillageLabel(c.origin),c.origin.id),h=f("village",j.genVillageLabel(c.target),c.target.id),i=j.formatDate(c.arriveTime-I),k=j.formatDate(c.sendTime-I),l=!!Object.keys(c.officers).length;if(e.innerHTML=m.render('<table class="tbl-border-light"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span class="icon-bg-<#= iconColor #> icon-26x26-<#= type #>" tooltip="<#= locale("common", type) #>"></span> <# if (section === "queue") { #> <span class="size-26x26 icon-bg-black icon-26x26-time-duration" tooltip="<#= locale("queue", "command.timeLeft") #>"></span> <span class="time-left">00:00:00</span> <# } #> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="<#= locale("queue", "command.out") #>"></span> <span class="sent-time"><#= sendTime #></span><span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="<#= locale("queue", "command.arrive") #>"></span> <span class="arrive-time"><#= arriveTime #></span> <# if (section === "queue") { #> <a href="#" class="remove-command size-20x20 btn-red icon-20x20-close" tooltip="<#= locale("queue", "queue.remove") #>"></a> <# } #> </th></tr><tr><td><#= locale("common", "villages") #></td><td><a class="origin"></a> <span class="size-20x20 icon-26x26-<#= type #>"></span> <a class="target"></a></td></tr><tr><td><#= locale("common", "units") #></td><td class="units"> <# for (var unit in units) { #> <div class="unit"> <# if (unit === "catapult" && type === "attack") { #> <span class="icon-34x34-unit-<#= unit #> icon"></span><span class="amount"><#= units[unit] #> <span>(<#= locale("common", catapultTarget) #>)</span></span> <# } else { #> <span class="icon-34x34-unit-<#= unit #> icon"></span><span class="amount"><#= units[unit] #></span> <# } #> </div> <# } #> <# if (hasOfficers) { #> <# for (var officer in officers) { #> <div class="officer"><span class="icon-34x34-premium_officer_<#= officer #>"></span></div> <# } #> <# } #> </td></tr></tbody></table>',{sendTime:k,type:c.type,arriveTime:i,units:c.units,hasOfficers:l,officers:c.officers,section:d,locale:b,catapultTarget:c.catapultTarget,iconColor:"attack"===c.type?"red":"blue"}),e.querySelector(".origin").replaceWith(g.elem),e.querySelector(".target").replaceWith(h.elem),"queue"===d){var n=e.querySelector(".remove-command"),o=e.querySelector(".time-left");n.addEventListener("click",function(b){a.removeCommand(c,"removed")}),ra(o,c.id)}y[d].append(e),p.setTooltips(),va(d)},qa=function(){var b=a.getWaitingCommandsObject();setInterval(function(){var a=l.gameTime()+I;if(!p.isVisible("queue"))return!1;for(var c in M){var d=b[c],e=d.sendTime-a;e>0&&(M[c].innerHTML=n("readableMillisecondsFilter")(e,!1,!0))}},1e3)},ra=function(a,b){M[b]=a},sa=function(a){delete M[a]},ta=function(b){var c=a.getWaitingCommandsObject();y.queue.find(".command").forEach(function(a){var d=c[a.dataset.id];d&&b(a,d)})},ua=function(b){var c=a.getWaitingCommands();Q.forEach(function(b){P[b]&&(c=a.filterCommands(b,R,c))});var d=c.map(function(a){return a.id});ta(function(a,b){a.style.display=d.includes(b.id)?"":"none"}),p.recalcScrollbar()},va=function(b){var c=y[b],d=c.find("p.nothing"),e="queue"===b?a.getWaitingCommands():c.find("div");d.css("display",0===e.length?"":"none")},wa=function(){z.on("selectSelected",function(){V=z[0].dataset.value,ia()}),s.on("click",function(b){a.isRunning()?a.stop():a.start()}),r.find(".buttons .add").on("click",function(){na(this.name)}),r.find("a.clear").on("click",function(){ya()}),r.find("a.addSelected").on("click",function(){K=d.getSelectedVillage().data,D.html(j.genVillageLabel(K)),O.origin=!0,K&&L&&Y(),a.getVillageByCoords(K.x,K.y,function(a){K=a,ia()})}),r.find("a.addMapSelected").on("click",function(){if(!W)return j.emitNotif("error",b("queue","error.noMapSelectedVillage"));L=W,E.html(j.genVillageLabel(L)),O.target=!0,K&&L&&Y(),a.getVillageByCoords(L.x,L.y,function(a){L=a,ia()})}),r.find("a.addCurrentDate").on("click",function(){w.val(ha()),w.trigger("input")});var e=function(a){return function(){var b="origin"===a?u:v,c=b.val();if(c.length<2)return h.hide();h.search(c,function(c){c.length&&h.show(c,b[0],"commandQueue-"+a)},["village"])}};u.on("input",e("origin")),v.on("input",e("target")),c.$on(g.SELECT_SELECTED,function(a,b,c){"commandQueue-origin"===b?(O.origin=!0,K=c,la(u),ia(),D.html(c.name)):"commandQueue-target"===b&&(O.target=!0,L=c,la(v),ia(),E.html(c.name)),K&&L||X()}),w.on("input",function(){O.date=j.isValidDateTime(w.val()),O.date?la(w):ka(w),ia()}),x.on("change",function(){ia()}),C.on("input",function(a){a.target.value?B.css("display",""):B.css("display","none")}),c.$on(g.SHOW_CONTEXT_MENU,function(a,b){W=b.data}),c.$on(g.DESTROY_CONTEXT_MENU,function(){W=!1}),c.$on(g.VILLAGE_SELECTED_CHANGED,function(){ua()})},xa=function(){A.find(".selectedVillage").on("click",function(){P.selectedVillage?this.classList.remove("active"):this.classList.add("active"),P.selectedVillage=!P.selectedVillage,ua()}),A.find(".barbarianTarget").on("click",function(){P.barbarianTarget?this.classList.remove("active"):this.classList.add("active"),P.barbarianTarget=!P.barbarianTarget,ua()}),A.find(".allowedTypes").on("click",function(){var a=this.dataset.filter,b=P[a];b?this.classList.remove("active"):this.classList.add("active"),P[a]=!b,R.allowedTypes[a]=!b,ua()}),A.find(".textMatch").on("input",function(a){clearTimeout(G),R[this.dataset.filter]=this.value,G=setTimeout(function(){ua()},250)})},ya=function(){a.getSentCommands().forEach(function(a){oa(a,"sent")}),a.getExpiredCommands().forEach(function(a){oa(a,"expired")}),a.clearRegisters()},za=function(a,c,d){return d&&(a=d+"."+a),b("queue",a)+" "+b("queue",c)},Aa=function(a){return!(l.gameTime()+I>a)},Ba=function(){var a={};return S.forEach(function(b){t.find(".officers ."+b).val()&&(a[b]=!0)}),a},Ca=function(){var a=T.filter(function(a){return"catapult"!==a});return a.push("catapult"),a};a.interface=function(){a.interface=o()}}),define("two/ui",["two/utils","queues/EventQueue","helper/dom","ejs"],function(b,d,e,f){function h(a,b){var d=this;return k.push(d),d.windowId=a,d.activeTab=b.activeTab,d.settings=b,m(a,b.css),d.buildWindow(),d.bindTabs(),d.setCollapse(),d.setTooltips(),d.setCheckboxes(),d.setSelects(),d.$window.querySelector(".twOverflow-close").addEventListener("click",function(){d.closeWindow()}),c.$on(g.WINDOW_CLOSED,function(b,c,e){(e||c===a)&&d.closeWindow()}),d}var j=!1,k=[],l=function(){k.forEach(function(a){a.closeWindow()})},m=function(a,b){var c=document.createElement("style");c.type="text/css",c.id="twOverflow-style-"+a,c.innerHTML=b,document.querySelector("head").appendChild(c)},n=function(d){var e=!1,f=document.createElement("span"),h=document.createElement("span"),i=document.createElement("span"),j=document.createElement("span"),k=function(a){var c=a.srcElement||a.target;b.matchesElem(c,".custom-select")||l()},l=function(){c.$broadcast(g.SELECT_HIDE,"custom-select"),$(a).off("click",k),$(".win-main").off("mousewheel",l),e=!1,o()},m=function(a,b){h.innerHTML=a.name,f.dataset.name=a.name,f.dataset.value=a.value,$(f).trigger("selectSelected"),l()},n=function(){i.classList.remove("icon-26x26-arrow-down"),i.classList.add("icon-26x26-arrow-up")},o=function(){i.classList.remove("icon-26x26-arrow-up"),i.classList.add("icon-26x26-arrow-down")};d.querySelectorAll("option").forEach(function(a){var b=document.createElement("span");b.dataset.name=a.innerText,b.dataset.value=a.value,j.appendChild(b),a.hasAttribute("selected")&&(h.innerHTML=a.innerText,f.dataset.name=a.innerText,f.dataset.value=a.value)});for(var p in d.dataset)f.dataset[p]=d.dataset[p];f.className="custom-select "+d.className,i.className="custom-select-button icon-26x26-arrow-down",h.className="custom-select-handler",j.className="custom-select-data",f.appendChild(h),f.appendChild(i),f.appendChild(j),f.addEventListener("click",function(){if(e)return l();var b=j.querySelectorAll("span"),d=[],i={};b.forEach(function(a){var b={name:a.dataset.name,value:a.dataset.value};a.dataset.icon&&(b.leftIcon=isNaN(a.dataset.icon)?a.dataset.icon:parseInt(a.dataset.icon,10)),a.dataset.name===h.innerHTML&&(i=b),d.push(b)}),c.$broadcast(g.SELECT_SHOW,"custom-select",d,i,m,f,!0),e=!0,n(),$(".win-main").on("mousewheel",l),$(a).on("click",k)}),d.replaceWith(f)};return h.prototype.buildWindow=function(){this.$wrapper=$("#wrapper"),this.$window=document.createElement("section"),this.$window.id=this.windowId,this.$window.className="twOverflow-window twx-window screen left",this.$window.style.visibility="hidden",this.$window.innerHTML=f.render(this.settings.template,this.settings.replaces),this.$wrapper.append(this.$window),this.$scrollbar=jsScrollbar(this.$window.querySelector(".win-main"))},h.prototype.openWindow=function(){i.closeAll(),l(),this.$window.style.visibility="visible",this.$wrapper.addClass("window-open"),this.resizeWindowFrame()},h.prototype.resizeWindowFrame=function(){d.trigger(d.types.RESIZE,{instant:!0,right:!0})},h.prototype.closeWindow=function(){"visible"===this.$window.style.visibility&&(this.settings.onClose&&this.settings.onClose(),this.$window.style.visibility="hidden",this.$wrapper.removeClass("window-open"),this.resizeWindowFrame())},h.prototype.toggleWindow=function(a){this.$window.style.visibility=a,this.$wrapper.toggleClass("window-open"),this.resizeWindowFrame()},h.prototype.tabsState=function(a,b){var c=this;if(a===b)return!1;c.$tabs.forEach(function(d){var e=d.getAttribute("tab");if(e!==a&&e!==b)return!1;c.$window.querySelector(".twOverflow-content-"+e),c.$window.querySelectorAll(".twOverflow-button-"+e),d.querySelector(".tab-inner > div"),d.querySelector("a");e===a?c.disableTab(e,d):e===b&&c.enableTab(e,d)})},h.prototype.bindTabs=function(){var a=this;a.$tabs=a.$window.querySelectorAll(".tab"),a.$tabs.forEach(function(b){var c=b.getAttribute("tab");b.addEventListener("click",function(){a.tabsState(a.activeTab,c),a.activeTab=c,a.settings.onTabClick&&a.settings.onTabClick(c)}),a.activeTab===c?a.enableTab(c,b):a.disableTab(c,b),a.recalcScrollbar()})},h.prototype.enableTab=function(a,b){var c=this.$window.querySelector(".twOverflow-content-"+a),d=this.$window.querySelectorAll(".twOverflow-button-"+a),e=b.querySelector(".tab-inner > div"),f=b.querySelector("a");c.style.display="",b.classList.add("tab-active"),e.classList.add("box-border-light"),f.classList.remove("btn-icon","btn-orange"),d.length&&d.forEach(function(a){a.style.display=""}),this.$scrollbar.content=c,this.recalcScrollbar()},h.prototype.disableTab=function(a,b){var c=this.$window.querySelector(".twOverflow-content-"+a),d=this.$window.querySelectorAll(".twOverflow-button-"+a),e=b.querySelector(".tab-inner > div"),f=b.querySelector("a");c.style.display="none",b.classList.remove("tab-active"),e.classList.remove("box-border-light"),f.classList.add("btn-icon","btn-orange"),d.length&&d.forEach(function(a){a.style.display="none"})},h.prototype.destroy=function(){document.querySelector("#twOverflow-style-"+this.windowId).remove(),this.$window.remove()},h.prototype.setCollapse=function(){var a=this;a.$window.querySelectorAll(".twx-section.collapse").forEach(function(b){var c=!b.classList.contains("hidden-content"),d=document.createElement("span");d.className="min-max-btn";var e=document.createElement("a");e.className="btn-orange icon-26x26-"+(c?"minus":"plus"),c||(b.nextSibling.style.display="none"),d.appendChild(e),b.appendChild(d),d.addEventListener("click",function(){"none"===b.nextSibling.style.display?(b.nextSibling.style.display="",e.className=e.className.replace("plus","minus"),c=!0):(b.nextSibling.style.display="none",e.className=e.className.replace("minus","plus"),c=!1),a.recalcScrollbar()})})},h.prototype.setTooltips=function(){var a=this,b=$("#tooltip");b.find(".tooltip-content-wrapper");a.$window.querySelectorAll("[tooltip]").forEach(function(a){var b=a.getAttribute("tooltip");a.removeAttribute("tooltip"),a.addEventListener("mouseenter",function(a){c.$broadcast(g.TOOLTIP_SHOW,"twoverflow-tooltip",b,!0,a)}),a.addEventListener("mouseleave",function(){c.$broadcast(g.TOOLTIP_HIDE,"twoverflow-tooltip")})})},h.prototype.setCheckboxes=function(){this.$window.querySelectorAll("input[type=checkbox]").forEach(function(a){a.addEventListener("click",function(){$(a).parent().toggleClass("icon-26x26-checkbox-checked")})})},h.prototype.isVisible=function(a){var b="visible"===this.$window.style.visibility;return b&&a&&(b=this.activeTab===a),b},
h.prototype.recalcScrollbar=function(){this.$scrollbar.recalc()},h.prototype.setSelects=function(){this.$window.querySelectorAll("select").forEach(function(a){n(a)})},h.init=function(){j=!0,m("own",'#twOverflow-leftbar{position:relative;top:0;left:0;margin-bottom:7px}#twOverflow-leftbar .button{white-space:nowrap;position:relative;top:-17px;left:0;min-width:70px;height:24px;padding:0 3px}#twOverflow-leftbar .label,#twOverflow-leftbar .quickview{margin:5px 0;font-size:12px}#twOverflow-leftbar .quickview{display:none}#wrapper.window-open #twOverflow-leftbar .button{left:720px}.twOverflow-window{visibility:hidden}.twOverflow-window h3{color:#000}.twOverflow-window p{color:#000;margin:7px 0;padding:0 40px}.twOverflow-window p span.sample{font-weight:bold;font-style:italic}.twOverflow-window p span.brazil{color:green;font-weight:bold}.twOverflow-window p .opensource{background:url(https://i.imgur.com/KFHdWXN.png);width:15px;height:15px;display:inline-block;vertical-align:-2px}.twOverflow-window input::placeholder{color:#6d563c}.twOverflow-window input[type="text"],.twOverflow-window input[type="number"],.twOverflow-window select{color:black;text-align:center}.twOverflow-window select{width:100%;padding:0 0 0 5px;font-size:14px;border:1px solid #976543;height:28px;text-decoration:none;text-align-last:center;border-radius:2px;font-weight:600;font-family:"Trebuchet MS";color:white;box-shadow:0 0 0 1px #421f09 inset,0 0 0 2px #976543 inset,0 0 0 3px #421f09 inset,0 -1px 1px 4px rgba(215,181,144,0.7) inset,0 0 1px 5px rgba(0,0,0,0.4) inset;-webkit-appearance:none;-moz-appearance:none;outline:none;background-image:url(https://i.imgur.com/SlaWRrX.png),url(https://i.imgur.com/e2qKrmX.png);background-repeat:no-repeat,repeat;background-position:293px -3px,top left;background-color:#b28e68}.twOverflow-window .custom-select{position:relative;display:inline-block}.twOverflow-window .custom-select .custom-select-button{height:21px;position:absolute;right:1px;top:1px}.twOverflow-window .custom-select .custom-select-handler{text-align:center;line-height:25px;height:25px;display:block;background:url("data:image/png;base64,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") top left #ceab84;box-shadow:inset 0 0 0 1px #533a1f,inset 0 0 0 2px #dcba94,0 0 2px rgba(0,0,0,0.6);padding:0 10px}.twOverflow-window .custom-select .custom-select-data{display:none}.twOverflow-window .center{text-align:center}.twOverflow-window .reduced{height:30px}@keyframes expand-button{100%{width:250px}}@keyframes contract-button{0%{width:250px}}.expand-button{animation:expand-button .1s forwards}.contract-button{animation:contract-button .1s forwards}.icon-26x26-preset{background-image:url(data:image/png;base64,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);margin-top:2px;margin-left:5px}')},h.isInitialized=function(){return j},h}),define("two/ui/autoComplete",["two/utils","two/locale","helper/dom","struct/MapData"],function(b,d,h,i){var j="two-autocomplete",k=!1,l=function(a){var c=a.srcElement||a.target;b.matchesElem(c,".custom-select")||n.hide()},m=function(a){n.hide(),c.$broadcast(g.SELECT_HIDE,j),c.$broadcast(g.SELECT_SELECTED,j,a)},n={};return n.hide=function(){c.$broadcast(g.SELECT_HIDE,j),$(a).off("click",l),$(".win-main").off("mousewheel",n.hide),k=!1},n.show=function(b,e,f,h){return j=f,!!b.length&&(c.$broadcast(g.SELECT_SHOW,j,b,null,m,e,!0,0,d("common","no-results")),k||(k=!0,$(".win-main").on("mousewheel",n.hide),$(a).on("click",l)),!0)},n.search=function(a,c,d,g){var h=[];if(b.isValidCoords(a)){var j=a.split("|").map(function(a){return parseInt(a,10)});return void i.loadTownDataAsync(j[0],j[1],1,1,function(a){a&&h.push({id:a.id,type:"village",name:b.genVillageLabel(a)}),c(h)})}e.emit(f.AUTOCOMPLETE,{types:d||["village","character","tribe"],string:a,amount:g||5},function(a){for(var d in a.result)a.result[d].forEach(function(a,c){a.type=d,a.leftIcon="size-34x34 icon-26x26-rte-"+d,"village"===d&&(a.name=b.genVillageLabel(a)),h.push(a)});c(h)})},n}),define("two/ui/buttonLink",["ejs"],function(a){return function(b,c,d){var e=Math.round(1e5*Math.random()),f=a.render('<a id="l<#= uid #>" class="img-link icon-20x20-<#= type #> btn btn-orange padded"><#= text #></a>',{type:b,text:c,uid:e}),g=document.createElement("div");g.innerHTML=f,g=g.firstChild;var i;switch(b){case"village":i=function(){h.openVillageInfo(d)};break;case"character":i=function(){h.openCharacterProfile(d)}}return g.addEventListener("click",i),{html:f,id:"l"+e,elem:g}}}),define("two/FrontButton",["ejs"],function(a){function b(a,b){this.options=b=angular.merge({label:a,className:"",classHover:"expand-button",classBlur:"contract-button",tooltip:!1,onClick:function(){}},b),this.buildWrapper(),this.appendButton();var d=this.$elem,e=d.find(".label"),f=d.find(".quickview");return b.classHover&&d.on("mouseenter",function(){d.addClass(b.classHover),d.removeClass(b.classBlur),e.hide(),f.show()}),b.classBlur&&d.on("mouseleave",function(){d.addClass(b.classBlur),d.removeClass(b.classHover),f.hide(),e.show()}),b.tooltip&&(d.on("mouseenter",function(a){c.$broadcast(g.TOOLTIP_SHOW,"twoverflow-tooltip",b.tooltip,!0,a)}),d.on("mouseleave",function(){c.$broadcast(g.TOOLTIP_HIDE,"twoverflow-tooltip")})),b.onClick&&this.click(b.onClick),this}return b.prototype.updateQuickview=function(a){this.$elem.find(".quickview").html(a)},b.prototype.hover=function(a){this.$elem.on("mouseenter",a)},b.prototype.click=function(a){this.$elem.on("click",a)},b.prototype.buildWrapper=function(){var a=document.getElementById("twOverflow-leftbar");a||(a=document.createElement("div"),a.id="twOverflow-leftbar",$("#toolbar-left").prepend(a)),this.$wrapper=a},b.prototype.appendButton=function(){var b=a.render('<div class="btn-border btn-green button <#= className #>"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="label"><#= label #></div><div class="quickview"></div></div>',{className:this.options.className,label:this.options.label}),c=document.createElement("div");c.innerHTML=b;var d=c.children[0];this.$wrapper.appendChild(d),this.$elem=$(d)},b.prototype.destroy=function(){this.$elem.remove()},b}),require(["two/ready","two/ui"],function(a,b){if(b.isInitialized())return!1;a(function(){b.init()})})}(this);
//# sourceMappingURL=tw2overflow.map
